2025-11-11 16:50:53,777Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 16:50:53,778Z - INFO - Connecting DB...
2025-11-11 16:50:53,844Z - INFO - DB OK
2025-11-11 16:50:53,845Z - INFO - Loading prices...
2025-11-11 16:52:53,152Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 16:52:56,739Z - INFO - Daily trends (SMA/trend)...
2025-11-11 16:52:58,312Z - INFO - Loading TE news...
2025-11-11 16:52:59,047Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 16:52:59,047Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 16:52:59,066Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 16:53:01,116Z - INFO - Dynamic horizon filter: 1456 -> 999 events (removed 457 with horizon < 5m)
2025-11-11 16:53:01,645Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 16:53:01,646Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 16:53:01,646Z - INFO - Building features...
2025-11-11 16:53:01,660Z - INFO - Loading correlation features...
2025-11-11 16:53:01,667Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 16:53:01,692Z - INFO - Applied currency/year correlation fallback.
2025-11-11 16:53:02,606Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 16:53:02,713Z - INFO - Time split @ 2025-11-10 08:36:12.400000+00:00: train=653, test=200
2025-11-11 16:53:02,714Z - INFO - Time split @ 2025-11-10 08:36:12.400000+00:00: train=653, test=200
2025-11-11 16:53:02,714Z - INFO - Class balance (train): Counter({np.int64(2): 323, np.int64(1): 205, np.int64(0): 125})
2025-11-11 16:53:02,715Z - INFO - Class balance (test): Counter({np.int64(0): 70, np.int64(1): 65, np.int64(2): 65})
2025-11-11 16:53:02,715Z - INFO - Baseline (majority=2) acc=0.3250
2025-11-11 16:53:02,716Z - INFO - Train RandomForest (direction)...
2025-11-11 16:53:04,003Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 16:54:10,738Z - INFO - Best XGB params: {'learning_rate': 0.1, 'max_depth': 6, 'n_estimators': 300}
2025-11-11 16:54:10,904Z - INFO - Pred counts (raw): [109, 80, 11]
2025-11-11 16:54:10,905Z - INFO - Avg probs (raw p0,p1,p2): [0.4263, 0.449, 0.1247]
2025-11-11 16:54:10,905Z - INFO - Train priors: [0.1914, 0.3139, 0.4946], alpha: [1.149, 1.015, 0.906]
2025-11-11 16:54:10,905Z - INFO - Avg probs (calibrated p0,p1,p2): [0.457, 0.4265, 0.1165]
2025-11-11 16:54:10,906Z - INFO - Pred counts (adj+margin): [119, 70, 11]
2025-11-11 16:54:10,909Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[47 17  6]
 [31 31  3]
 [41 22  2]]
2025-11-11 16:54:10,918Z - INFO - 
              precision    recall  f1-score   support

           0      0.395     0.671     0.497        70
           1      0.443     0.477     0.459        65
           2      0.182     0.031     0.053        65

    accuracy                          0.400       200
   macro avg      0.340     0.393     0.336       200
weighted avg      0.341     0.400     0.340       200

2025-11-11 16:54:10,921Z - INFO - Ensemble (RF+XGB) direction: acc=0.4000 f1=0.3364
2025-11-11 16:54:13,211Z - INFO - 
[2-stage] Confusion (0,1,2 rows vs cols):
[[54  9  7]
 [33 26  6]
 [47  9  9]]
2025-11-11 16:54:13,211Z - INFO - [2-stage] acc=0.4450 macroF1=0.4045 move_cov=0.78
2025-11-11 16:54:13,211Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 16:54:13,214Z - INFO - Conf>=0.50: coverage=75.50% n=151 acc=0.457 f1=0.379
2025-11-11 16:54:13,217Z - INFO - Conf>=0.55: coverage=64.50% n=129 acc=0.488 f1=0.410
2025-11-11 16:54:13,220Z - INFO - Conf>=0.60: coverage=48.00% n= 96 acc=0.500 f1=0.388
2025-11-11 16:54:13,223Z - INFO - Conf>=0.65: coverage=34.00% n= 68 acc=0.471 f1=0.371
2025-11-11 16:54:13,225Z - INFO - Conf>=0.70: coverage=13.50% n= 27 acc=0.667 f1=0.357
2025-11-11 16:54:13,228Z - INFO - Conf>=0.75: coverage= 7.00% n= 14 acc=0.929 f1=0.481
2025-11-11 16:54:13,228Z - INFO - 
=== Trade gate: conf>=0.65 + p_move>=0.60 ===
2025-11-11 16:54:13,231Z - INFO - Trade gate coverage=23.00% n= 46 acc=0.370 f1=0.227
2025-11-11 16:54:13,234Z - INFO - Trade gate coverage=23.00% n= 46 acc=0.304 f1=0.161
2025-11-11 16:54:13,234Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 16:54:13,248Z - INFO - 
Top 10 best performing events:
2025-11-11 16:54:13,249Z - INFO -   te_stock_market_france: acc=1.000 (4/4) avg_delta=+1.25 avg_delta_dyn=+5.08 avg_mag=2.35
2025-11-11 16:54:13,249Z - INFO -   te_stock_market_indonesia: acc=1.000 (3/3) avg_delta=-2.30 avg_delta_dyn=+3.60 avg_mag=2.30
2025-11-11 16:54:13,249Z - INFO -   te_stock_market_japan: acc=1.000 (3/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=4.73
2025-11-11 16:54:13,249Z - INFO -   te_stock_market_germany: acc=1.000 (3/3) avg_delta=+0.27 avg_delta_dyn=+5.27 avg_mag=4.53
2025-11-11 16:54:13,250Z - INFO -   te_stock_market_euro_area: acc=0.750 (3/4) avg_delta=-3.02 avg_delta_dyn=+5.45 avg_mag=4.67
2025-11-11 16:54:13,250Z - INFO -   te_misc_currency: acc=0.667 (4/6) avg_delta=+0.25 avg_delta_dyn=-0.70 avg_mag=1.98
2025-11-11 16:54:13,250Z - INFO -   te_stock_market_italy: acc=0.600 (3/5) avg_delta=-1.94 avg_delta_dyn=+1.02 avg_mag=3.22
2025-11-11 16:54:13,250Z - INFO -   te_stocks_united_kingdom: acc=0.500 (2/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 16:54:13,250Z - INFO -   te_misc_commodity: acc=0.500 (17/34) avg_delta=-0.82 avg_delta_dyn=+0.73 avg_mag=2.53
2025-11-11 16:54:13,251Z - INFO -   te_stock_market_united_states: acc=0.429 (3/7) avg_delta=-1.54 avg_delta_dyn=-3.01 avg_mag=2.83
2025-11-11 16:54:13,251Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 16:54:13,251Z - INFO -   te_stock_market_germany: acc=1.000 (3/3) avg_delta=+0.27 avg_delta_dyn=+5.27 avg_mag=4.53
2025-11-11 16:54:13,252Z - INFO -   te_stock_market_euro_area: acc=0.750 (3/4) avg_delta=-3.02 avg_delta_dyn=+5.45 avg_mag=4.67
2025-11-11 16:54:13,252Z - INFO -   te_misc_currency: acc=0.667 (4/6) avg_delta=+0.25 avg_delta_dyn=-0.70 avg_mag=1.98
2025-11-11 16:54:13,252Z - INFO -   te_stock_market_italy: acc=0.600 (3/5) avg_delta=-1.94 avg_delta_dyn=+1.02 avg_mag=3.22
2025-11-11 16:54:13,252Z - INFO -   te_stocks_united_kingdom: acc=0.500 (2/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 16:54:13,253Z - INFO -   te_misc_commodity: acc=0.500 (17/34) avg_delta=-0.82 avg_delta_dyn=+0.73 avg_mag=2.53
2025-11-11 16:54:13,253Z - INFO -   te_stock_market_united_states: acc=0.429 (3/7) avg_delta=-1.54 avg_delta_dyn=-3.01 avg_mag=2.83
2025-11-11 16:54:13,253Z - INFO -   te_stock_market_canada: acc=0.333 (1/3) avg_delta=-0.50 avg_delta_dyn=-1.37 avg_mag=7.10
2025-11-11 16:54:13,253Z - INFO -   te_stock_market_united_kingdom: acc=0.333 (2/6) avg_delta=+0.08 avg_delta_dyn=+2.87 avg_mag=0.92
2025-11-11 16:54:13,253Z - INFO -   te_stock_market_india: acc=0.000 (0/3) avg_delta=+2.07 avg_delta_dyn=+2.80 avg_mag=2.40
2025-11-11 16:54:13,423Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 16:54:22,138Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 16:54:33,189Z - INFO - RMSE magnitude (pips) @+15m: 2.7797
2025-11-11 16:54:33,200Z - INFO - ==== TE V5 Trainer done ====
