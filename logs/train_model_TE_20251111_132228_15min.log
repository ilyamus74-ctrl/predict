2025-11-11 15:22:28,816Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 15:22:28,816Z - INFO - Connecting DB...
2025-11-11 15:22:28,874Z - INFO - DB OK
2025-11-11 15:22:28,874Z - INFO - Loading prices...
2025-11-11 15:24:24,052Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 15:24:27,600Z - INFO - Daily trends (SMA/trend)...
2025-11-11 15:24:29,152Z - INFO - Loading TE news...
2025-11-11 15:24:29,706Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 15:24:29,706Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 15:24:29,783Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 15:24:31,774Z - INFO - Dynamic horizon filter: 1443 -> 986 events (removed 457 with horizon < 5m)
2025-11-11 15:24:32,267Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 15:24:32,267Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 15:24:32,267Z - INFO - Building features...
2025-11-11 15:24:32,282Z - INFO - Loading correlation features...
2025-11-11 15:24:32,395Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 15:24:32,426Z - INFO - Applied currency/year correlation fallback.
2025-11-11 15:24:33,330Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 15:24:33,336Z - WARNING - Dropping constant features: ['imp_year_trend', 'price_change', 'corr_direction', 'probability', 'observations']
2025-11-11 15:24:33,416Z - INFO - Time split @ 2025-11-10 07:54:13+00:00: train=788, test=198
2025-11-11 15:24:33,417Z - INFO - Class balance (train): Counter({np.int64(2): 353, np.int64(1): 272, np.int64(0): 163})
2025-11-11 15:24:33,417Z - INFO - Class balance (test): Counter({np.int64(1): 74, np.int64(0): 70, np.int64(2): 54})
2025-11-11 15:24:33,418Z - INFO - Baseline (majority=2) acc=0.2727
2025-11-11 15:24:33,418Z - INFO - Train RandomForest (direction)...
2025-11-11 15:24:34,940Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 15:24:40,131Z - INFO - Best XGB params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 300}
2025-11-11 15:24:40,284Z - INFO - Pred counts (raw): [62, 136, 0]
2025-11-11 15:24:40,285Z - INFO - Avg probs (raw p0,p1,p2): [0.3261, 0.6224, 0.0515]
2025-11-11 15:24:40,285Z - INFO - Pred counts (adj+margin): [62, 136, 0]
2025-11-11 15:24:40,287Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[28 42  0]
 [13 61  0]
 [21 33  0]]
2025-11-11 15:24:40,296Z - INFO - 
              precision    recall  f1-score   support

           0      0.452     0.400     0.424        70
           1      0.449     0.824     0.581        74
           2      0.000     0.000     0.000        54

    accuracy                          0.449       198
   macro avg      0.300     0.408     0.335       198
weighted avg      0.327     0.449     0.367       198

2025-11-11 15:24:40,298Z - INFO - Ensemble (RF+XGB+BRF) direction: acc=0.4495 f1=0.3351
2025-11-11 15:24:40,298Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 15:24:40,301Z - INFO - Conf>=0.50: coverage=93.43% n=185 acc=0.470 f1=0.347
2025-11-11 15:24:40,304Z - INFO - Conf>=0.55: coverage=71.72% n=142 acc=0.486 f1=0.346
2025-11-11 15:24:40,308Z - INFO - Conf>=0.60: coverage=48.99% n= 97 acc=0.495 f1=0.245
2025-11-11 15:24:40,313Z - INFO - Conf>=0.65: coverage=40.91% n= 81 acc=0.543 f1=0.235
2025-11-11 15:24:40,316Z - INFO - Conf>=0.70: coverage=30.81% n= 61 acc=0.541 f1=0.234
2025-11-11 15:24:40,319Z - INFO - Conf>=0.75: coverage=26.77% n= 53 acc=0.547 f1=0.236
2025-11-11 15:24:40,319Z - INFO - 
=== Trade gate: conf>=0.65 + class-specific cutoffs ===
