2025-11-11 14:07:32,896Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 14:07:32,896Z - INFO - Connecting DB...
2025-11-11 14:07:32,952Z - INFO - DB OK
2025-11-11 14:07:32,952Z - INFO - Loading prices...
2025-11-11 14:09:29,471Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 14:09:33,016Z - INFO - Daily trends (SMA/trend)...
2025-11-11 14:09:34,520Z - INFO - Loading TE news...
2025-11-11 14:09:34,720Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 14:09:34,721Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 14:09:34,886Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 14:09:36,818Z - INFO - Dynamic horizon filter: 1439 -> 982 events (removed 457 with horizon < 5m)
2025-11-11 14:09:37,297Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 14:09:37,298Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 14:09:37,298Z - INFO - Building features...
2025-11-11 14:09:37,312Z - INFO - Loading correlation features...
2025-11-11 14:09:37,419Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 14:09:37,446Z - INFO - Applied currency/year correlation fallback.
2025-11-11 14:09:38,400Z - INFO - Oversampling to max class: before=[205, 352, 228], after=[352, 352, 352]
2025-11-11 14:09:38,400Z - INFO - Time split @ 2025-11-10 07:44:48.800000+00:00: train=785, test=197
2025-11-11 14:09:38,400Z - INFO - Class balance (train): Counter({np.int64(1): 352, np.int64(2): 228, np.int64(0): 205})
2025-11-11 14:09:38,401Z - INFO - Class balance (test): Counter({np.int64(1): 72, np.int64(0): 66, np.int64(2): 59})
2025-11-11 14:09:38,401Z - INFO - Baseline (majority=1) acc=0.3655
2025-11-11 14:09:38,401Z - INFO - Train RandomForest (direction)...
2025-11-11 14:09:39,780Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 14:10:13,590Z - INFO - Best XGB params: {'colsample_bytree': 0.7, 'learning_rate': 0.05, 'max_depth': 6, 'n_estimators': 200, 'subsample': 0.7}
2025-11-11 14:10:16,483Z - INFO - Pred counts (raw): [13, 183, 1]
2025-11-11 14:10:16,483Z - INFO - Avg probs (raw p0,p1,p2): [0.2008, 0.656, 0.1432]
2025-11-11 14:10:16,483Z - INFO - Train priors: [0.2611, 0.4484, 0.2904], alpha: [1.116, 0.875, 1.064]
2025-11-11 14:10:16,483Z - INFO - Applied post-ensemble bias (p0×1.05, p2×1.18)
2025-11-11 14:10:16,484Z - INFO - Avg probs (adj p0,p1,p2): [0.2312, 0.5918, 0.1771]
2025-11-11 14:10:16,484Z - INFO - Pred counts (adj+margin): [24, 160, 13]
2025-11-11 14:10:16,487Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 7 49 10]
 [ 7 63  2]
 [10 48  1]]
2025-11-11 14:10:16,498Z - INFO - 
              precision    recall  f1-score   support

           0      0.292     0.106     0.156        66
           1      0.394     0.875     0.543        72
           2      0.077     0.017     0.028        59

    accuracy                          0.360       197
   macro avg      0.254     0.333     0.242       197
weighted avg      0.265     0.360     0.259       197

2025-11-11 14:10:16,501Z - INFO - Ensemble (RF+XGB+BRF) direction: acc=0.3604 f1=0.2421
2025-11-11 14:10:16,501Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 14:10:16,504Z - INFO - Conf>=0.50: coverage=72.08% n=142 acc=0.423 f1=0.231
2025-11-11 14:10:16,507Z - INFO - Conf>=0.55: coverage=58.38% n=115 acc=0.470 f1=0.258
2025-11-11 14:10:16,510Z - INFO - Conf>=0.60: coverage=48.73% n= 96 acc=0.500 f1=0.225
2025-11-11 14:10:16,513Z - INFO - Conf>=0.65: coverage=35.03% n= 69 acc=0.493 f1=0.220
2025-11-11 14:10:16,515Z - INFO - Conf>=0.70: coverage=25.38% n= 50 acc=0.500 f1=0.222
2025-11-11 14:10:16,518Z - INFO - Conf>=0.75: coverage=17.77% n= 35 acc=0.571 f1=0.242
2025-11-11 14:10:16,518Z - INFO - 
=== Trade gate: conf>=0.70 + class-specific cutoffs ===
2025-11-11 14:10:16,521Z - INFO - Trade gate coverage=25.38% n= 50 acc=0.500 f1=0.222
2025-11-11 14:10:16,521Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 14:10:16,532Z - INFO - 
Top 10 best performing events:
2025-11-11 14:10:16,532Z - INFO -   te_stock_market_hong_kong: acc=1.000 (3/3) avg_delta=-0.30 avg_delta_dyn=-2.20 avg_mag=3.27
2025-11-11 14:10:16,532Z - INFO -   te_stock_market_china: acc=0.667 (2/3) avg_delta=+0.90 avg_delta_dyn=+4.33 avg_mag=4.33
2025-11-11 14:10:16,533Z - INFO -   te_stocks_united_kingdom: acc=0.500 (2/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=5.15
2025-11-11 14:10:16,533Z - INFO -   te_stock_market_euro_area: acc=0.500 (2/4) avg_delta=-3.12 avg_delta_dyn=-4.17 avg_mag=4.17
2025-11-11 14:10:16,533Z - INFO -   te_misc_commodity: acc=0.455 (15/33) avg_delta=-0.77 avg_delta_dyn=+0.54 avg_mag=2.98
2025-11-11 14:10:16,533Z - INFO -   te_misc_currency: acc=0.333 (2/6) avg_delta=+1.23 avg_delta_dyn=-0.45 avg_mag=4.82
2025-11-11 14:10:16,533Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=7.27
2025-11-11 14:10:16,534Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-0.27 avg_delta_dyn=-0.93 avg_mag=4.20
2025-11-11 14:10:16,534Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+3.05 avg_delta_dyn=+6.45 avg_mag=6.45
2025-11-11 14:10:16,534Z - INFO -   te_stock_market_france: acc=0.200 (1/5) avg_delta=+2.30 avg_delta_dyn=+4.16 avg_mag=6.72
2025-11-11 14:10:16,534Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 14:10:16,534Z - INFO -   te_misc_commodity: acc=0.455 (15/33) avg_delta=-0.77 avg_delta_dyn=+0.54 avg_mag=2.98
2025-11-11 14:10:16,535Z - INFO -   te_misc_currency: acc=0.333 (2/6) avg_delta=+1.23 avg_delta_dyn=-0.45 avg_mag=4.82
2025-11-11 14:10:16,535Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=7.27
2025-11-11 14:10:16,535Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-0.27 avg_delta_dyn=-0.93 avg_mag=4.20
2025-11-11 14:10:16,535Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+3.05 avg_delta_dyn=+6.45 avg_mag=6.45
2025-11-11 14:10:16,535Z - INFO -   te_stock_market_france: acc=0.200 (1/5) avg_delta=+2.30 avg_delta_dyn=+4.16 avg_mag=6.72
2025-11-11 14:10:16,536Z - INFO -   te_stock_market_united_kingdom: acc=0.200 (1/5) avg_delta=+0.52 avg_delta_dyn=+0.74 avg_mag=5.94
2025-11-11 14:10:16,536Z - INFO -   te_stock_market_united_states: acc=0.200 (1/5) avg_delta=-1.56 avg_delta_dyn=-4.88 avg_mag=4.88
2025-11-11 14:10:16,536Z - INFO -   te_stock_market_italy: acc=0.000 (0/5) avg_delta=+1.18 avg_delta_dyn=+0.84 avg_mag=6.12
2025-11-11 14:10:16,536Z - INFO -   te_stock_market_india: acc=0.000 (0/3) avg_delta=+1.77 avg_delta_dyn=+2.53 avg_mag=6.40
2025-11-11 14:10:16,681Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 14:10:59,922Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 400}
2025-11-11 14:10:59,933Z - INFO - RMSE magnitude (pips) @+15m: 5.0601
2025-11-11 14:10:59,942Z - INFO - ==== TE V5 Trainer done ====
