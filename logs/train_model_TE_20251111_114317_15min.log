2025-11-11 13:43:17,358Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 13:43:17,358Z - INFO - Connecting DB...
2025-11-11 13:43:17,413Z - INFO - DB OK
2025-11-11 13:43:17,413Z - INFO - Loading prices...
2025-11-11 13:45:24,433Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 13:45:28,179Z - INFO - Daily trends (SMA/trend)...
2025-11-11 13:45:29,863Z - INFO - Loading TE news...
2025-11-11 13:45:43,284Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 13:45:43,285Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 13:45:44,712Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 13:45:46,672Z - INFO - Dynamic horizon filter: 1437 -> 978 events (removed 459 with horizon < 5m)
2025-11-11 13:45:47,150Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 13:45:47,150Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 13:45:47,150Z - INFO - Building features...
2025-11-11 13:45:47,412Z - INFO - Loading correlation features...
2025-11-11 13:45:47,647Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 13:45:49,203Z - INFO - Applied currency/year correlation fallback.
2025-11-11 13:45:50,414Z - WARNING - Dropping constant features: ['imp_year_trend', 'price_change', 'corr_direction', 'probability', 'observations']
2025-11-11 13:45:50,514Z - INFO - Oversampling to max class: before=[205, 349, 228], after=[349, 349, 349]
2025-11-11 13:45:50,514Z - INFO - Time split @ 2025-11-10 07:35:48.600000+00:00: train=782, test=196
2025-11-11 13:45:50,515Z - INFO - Class balance (train): Counter({np.int64(1): 349, np.int64(2): 228, np.int64(0): 205})
2025-11-11 13:45:50,515Z - INFO - Class balance (test): Counter({np.int64(1): 73, np.int64(2): 69, np.int64(0): 54})
2025-11-11 13:45:50,516Z - INFO - Baseline (majority=1) acc=0.3724
2025-11-11 13:45:50,516Z - INFO - Train RandomForest (direction)...
2025-11-11 13:45:51,651Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 13:48:48,227Z - INFO - Best XGB params: {'colsample_bytree': 1.0, 'learning_rate': 0.1, 'max_depth': 3, 'n_estimators': 400, 'subsample': 1.0}
2025-11-11 13:48:52,151Z - INFO - Pred counts (raw): [22, 171, 3]
2025-11-11 13:48:52,152Z - INFO - Avg probs (raw p0,p1,p2): [0.1769, 0.6875, 0.1356]
2025-11-11 13:48:52,153Z - INFO - Train priors: [0.2621, 0.4463, 0.2916], alpha: [1.114, 0.877, 1.062]
2025-11-11 13:48:52,154Z - INFO - Avg probs (adj p0,p1,p2): [0.2027, 0.6469, 0.1504]
2025-11-11 13:48:52,154Z - INFO - Pred counts (adj+margin): [26, 167, 3]
2025-11-11 13:48:52,159Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[10 42  2]
 [ 4 68  1]
 [12 57  0]]
2025-11-11 13:48:52,175Z - INFO - 
              precision    recall  f1-score   support

           0      0.385     0.185     0.250        54
           1      0.407     0.932     0.567        73
           2      0.000     0.000     0.000        69

    accuracy                          0.398       196
   macro avg      0.264     0.372     0.272       196
weighted avg      0.258     0.398     0.280       196

2025-11-11 13:48:52,178Z - INFO - Ensemble (RF+XGB+BRF) direction: acc=0.3980 f1=0.2722
2025-11-11 13:48:52,178Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 13:48:52,180Z - INFO - Conf>=0.50: coverage=84.18% n=165 acc=0.418 f1=0.255
2025-11-11 13:48:52,183Z - INFO - Conf>=0.55: coverage=75.00% n=147 acc=0.435 f1=0.224
2025-11-11 13:48:52,185Z - INFO - Conf>=0.60: coverage=63.27% n=124 acc=0.452 f1=0.207
2025-11-11 13:48:52,187Z - INFO - Conf>=0.65: coverage=55.10% n=108 acc=0.491 f1=0.219
2025-11-11 13:48:52,190Z - INFO - Conf>=0.70: coverage=43.37% n= 85 acc=0.529 f1=0.231
2025-11-11 13:48:52,192Z - INFO - Conf>=0.75: coverage=27.04% n= 53 acc=0.585 f1=0.246
2025-11-11 13:48:52,192Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 13:48:52,203Z - INFO - 
Top 10 best performing events:
2025-11-11 13:48:52,204Z - INFO -   te_stock_market_china: acc=0.750 (3/4) avg_delta=+0.68 avg_delta_dyn=+3.25 avg_mag=3.25
2025-11-11 13:48:52,204Z - INFO -   te_stock_market_hong_kong: acc=0.667 (2/3) avg_delta=-2.43 avg_delta_dyn=+2.77 avg_mag=3.10
2025-11-11 13:48:52,204Z - INFO -   te_misc_commodity: acc=0.529 (18/34) avg_delta=-0.96 avg_delta_dyn=+0.32 avg_mag=2.62
2025-11-11 13:48:52,204Z - INFO -   te_stock_market_euro_area: acc=0.500 (2/4) avg_delta=-4.72 avg_delta_dyn=-0.45 avg_mag=4.05
2025-11-11 13:48:52,205Z - INFO -   te_stock_market_france: acc=0.400 (2/5) avg_delta=+0.32 avg_delta_dyn=+4.30 avg_mag=6.86
2025-11-11 13:48:52,205Z - INFO -   te_stock_market_united_states: acc=0.400 (2/5) avg_delta=-1.56 avg_delta_dyn=-4.68 avg_mag=4.68
2025-11-11 13:48:52,205Z - INFO -   te_misc_currency: acc=0.333 (2/6) avg_delta=-0.42 avg_delta_dyn=-0.33 avg_mag=4.93
2025-11-11 13:48:52,205Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=7.27
2025-11-11 13:48:52,205Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-2.40 avg_delta_dyn=+4.03 avg_mag=4.03
2025-11-11 13:48:52,205Z - INFO -   te_stocks_united_kingdom: acc=0.333 (1/3) avg_delta=-0.53 avg_delta_dyn=-1.73 avg_mag=4.33
2025-11-11 13:48:52,205Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 13:48:52,206Z - INFO -   te_stock_market_euro_area: acc=0.500 (2/4) avg_delta=-4.72 avg_delta_dyn=-0.45 avg_mag=4.05
2025-11-11 13:48:52,206Z - INFO -   te_stock_market_france: acc=0.400 (2/5) avg_delta=+0.32 avg_delta_dyn=+4.30 avg_mag=6.86
2025-11-11 13:48:52,206Z - INFO -   te_stock_market_united_states: acc=0.400 (2/5) avg_delta=-1.56 avg_delta_dyn=-4.68 avg_mag=4.68
2025-11-11 13:48:52,206Z - INFO -   te_misc_currency: acc=0.333 (2/6) avg_delta=-0.42 avg_delta_dyn=-0.33 avg_mag=4.93
2025-11-11 13:48:52,207Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=7.27
2025-11-11 13:48:52,207Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-2.40 avg_delta_dyn=+4.03 avg_mag=4.03
2025-11-11 13:48:52,207Z - INFO -   te_stocks_united_kingdom: acc=0.333 (1/3) avg_delta=-0.53 avg_delta_dyn=-1.73 avg_mag=4.33
2025-11-11 13:48:52,207Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+0.57 avg_delta_dyn=+6.62 avg_mag=6.62
2025-11-11 13:48:52,207Z - INFO -   te_stock_market_italy: acc=0.250 (1/4) avg_delta=-1.38 avg_delta_dyn=+3.15 avg_mag=5.90
2025-11-11 13:48:52,207Z - INFO -   te_stock_market_united_kingdom: acc=0.200 (1/5) avg_delta=-0.76 avg_delta_dyn=+3.72 avg_mag=5.84
2025-11-11 13:48:52,354Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 13:48:54,663Z - INFO - Best XGBReg params: {'learning_rate': 0.1, 'max_depth': 4, 'n_estimators': 400}
2025-11-11 13:48:54,669Z - INFO - RMSE magnitude (pips) @+15m: 4.8150
2025-11-11 13:48:54,677Z - INFO - ==== TE V5 Trainer done ====
