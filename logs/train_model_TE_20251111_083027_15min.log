2025-11-11 10:30:27,036Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 10:30:27,036Z - INFO - Connecting DB...
2025-11-11 10:30:27,113Z - INFO - DB OK
2025-11-11 10:30:27,114Z - INFO - Loading prices...
2025-11-11 10:32:35,656Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 10:32:39,720Z - INFO - Daily trends (SMA/trend)...
2025-11-11 10:32:41,456Z - INFO - Loading TE news...
2025-11-11 10:32:50,411Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 10:32:50,412Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 10:32:50,681Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 10:32:52,873Z - INFO - Dynamic horizon filter: 1416 -> 752 events (removed 664 with horizon < 5m)
2025-11-11 10:32:53,421Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 10:32:53,421Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 10:32:53,421Z - INFO - Building features...
2025-11-11 10:32:53,437Z - INFO - Loading correlation features...
2025-11-11 10:32:53,517Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 10:32:53,547Z - INFO - Applied currency/year correlation fallback.
2025-11-11 10:32:54,517Z - WARNING - Dropping constant features: ['imp_year_trend', 'price_change', 'corr_direction', 'probability', 'observations']
2025-11-11 10:32:54,583Z - INFO - Oversampling: class counts before=[135, 289, 177], after=[289, 289, 289]
2025-11-11 10:32:54,583Z - INFO - Time split @ 2025-11-10 09:12:13.800000+00:00: train=601, test=151
2025-11-11 10:32:54,583Z - INFO - Class balance (train): Counter({np.int64(1): 289, np.int64(2): 177, np.int64(0): 135})
2025-11-11 10:32:54,584Z - INFO - Class balance (test): Counter({np.int64(0): 51, np.int64(1): 51, np.int64(2): 49})
2025-11-11 10:32:54,584Z - INFO - Baseline (majority=1) acc=0.3377
2025-11-11 10:32:54,584Z - INFO - Train RandomForest (direction)...
2025-11-11 10:32:56,038Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 10:35:53,203Z - INFO - Best XGB params: {'colsample_bytree': 1.0, 'learning_rate': 0.1, 'max_depth': 6, 'n_estimators': 400, 'subsample': 1.0}
2025-11-11 10:35:56,635Z - INFO - Train priors: [0.2246, 0.4809, 0.2945], alpha: [1.267, 0.803, 1.077]
2025-11-11 10:35:56,635Z - INFO - Pred counts (0,1,2) adj: [52, 82, 17]
2025-11-11 10:35:56,635Z - INFO - Avg probs adj (p0,p1,p2): [0.319, 0.4688, 0.2122]
2025-11-11 10:35:56,635Z - INFO - Pred counts (0,1,2): [31, 108, 12]
2025-11-11 10:35:56,636Z - INFO - Avg probs (p0,p1,p2): [np.float64(0.2545), np.float64(0.5516), np.float64(0.1939)]
2025-11-11 10:35:56,638Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 6 36  9]
 [ 9 41  1]
 [16 31  2]]
2025-11-11 10:35:56,649Z - INFO - 
              precision    recall  f1-score   support

           0      0.194     0.118     0.146        51
           1      0.380     0.804     0.516        51
           2      0.167     0.041     0.066        49

    accuracy                          0.325       151
   macro avg      0.247     0.321     0.243       151
weighted avg      0.248     0.325     0.245       151

2025-11-11 10:35:56,654Z - INFO - Ensemble (RF+XGB) direction: acc=0.3245 f1=0.2425
2025-11-11 10:35:56,654Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 10:35:56,657Z - INFO - Conf>=0.50: coverage=69.54% n=105 acc=0.305 f1=0.187
2025-11-11 10:35:56,660Z - INFO - Conf>=0.55: coverage=56.95% n= 86 acc=0.360 f1=0.210
2025-11-11 10:35:56,663Z - INFO - Conf>=0.60: coverage=47.02% n= 71 acc=0.366 f1=0.182
2025-11-11 10:35:56,666Z - INFO - Conf>=0.65: coverage=35.10% n= 53 acc=0.415 f1=0.196
2025-11-11 10:35:56,669Z - INFO - Conf>=0.70: coverage=25.83% n= 39 acc=0.359 f1=0.176
2025-11-11 10:35:56,672Z - INFO - Conf>=0.75: coverage=20.53% n= 31 acc=0.323 f1=0.163
2025-11-11 10:35:56,675Z - INFO - Class-thresholds {0: 0.55, 1: 0.62, 2: 0.55}: coverage=47.02% n=71 acc=0.366 f1=0.217
2025-11-11 10:35:56,679Z - INFO - Class-thresholds {0: 0.6, 1: 0.64, 2: 0.58}: coverage=40.40% n=61 acc=0.393 f1=0.195
2025-11-11 10:35:56,679Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 10:35:56,691Z - INFO - 
Top 10 best performing events:
2025-11-11 10:35:56,692Z - INFO -   te_stock_market_united_states: acc=0.500 (2/4) avg_delta=-1.80 avg_mag=1.80
2025-11-11 10:35:56,692Z - INFO -   te_misc_currency: acc=0.400 (2/5) avg_delta=+0.48 avg_mag=2.20
2025-11-11 10:35:56,692Z - INFO -   te_stock_market_italy: acc=0.333 (1/3) avg_delta=+1.67 avg_mag=4.20
2025-11-11 10:35:56,692Z - INFO -   te_stock_market_united_kingdom: acc=0.333 (1/3) avg_delta=+0.37 avg_mag=1.37
2025-11-11 10:35:56,693Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_mag=4.73
2025-11-11 10:35:56,693Z - INFO -   te_misc_commodity: acc=0.296 (8/27) avg_delta=-1.14 avg_mag=2.67
2025-11-11 10:35:56,693Z - INFO -   te_stocks_united_kingdom: acc=0.000 (0/3) avg_delta=-1.83 avg_mag=1.83
2025-11-11 10:35:56,693Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 10:35:56,693Z - INFO -   te_stock_market_united_states: acc=0.500 (2/4) avg_delta=-1.80 avg_mag=1.80
2025-11-11 10:35:56,694Z - INFO -   te_misc_currency: acc=0.400 (2/5) avg_delta=+0.48 avg_mag=2.20
2025-11-11 10:35:56,694Z - INFO -   te_stock_market_italy: acc=0.333 (1/3) avg_delta=+1.67 avg_mag=4.20
2025-11-11 10:35:56,694Z - INFO -   te_stock_market_united_kingdom: acc=0.333 (1/3) avg_delta=+0.37 avg_mag=1.37
2025-11-11 10:35:56,694Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_mag=4.73
2025-11-11 10:35:56,694Z - INFO -   te_misc_commodity: acc=0.296 (8/27) avg_delta=-1.14 avg_mag=2.67
2025-11-11 10:35:56,695Z - INFO -   te_stocks_united_kingdom: acc=0.000 (0/3) avg_delta=-1.83 avg_mag=1.83
2025-11-11 10:35:56,898Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 10:36:31,126Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 6, 'n_estimators': 400}
2025-11-11 10:36:31,133Z - INFO - RMSE magnitude (pips) @+15m: 4.1401
2025-11-11 10:36:31,141Z - INFO - ==== TE V5 Trainer done ====
