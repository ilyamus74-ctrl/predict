2025-11-11 14:52:45,542Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 14:52:45,542Z - INFO - Connecting DB...
2025-11-11 14:52:45,596Z - INFO - DB OK
2025-11-11 14:52:45,596Z - INFO - Loading prices...
2025-11-11 14:54:37,289Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 14:54:40,833Z - INFO - Daily trends (SMA/trend)...
2025-11-11 14:54:42,359Z - INFO - Loading TE news...
2025-11-11 14:54:42,625Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 14:54:42,626Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 14:54:42,642Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 14:54:44,679Z - INFO - Dynamic horizon filter: 1443 -> 986 events (removed 457 with horizon < 5m)
2025-11-11 14:54:45,176Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 14:54:45,176Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 14:54:45,176Z - INFO - Building features...
2025-11-11 14:54:45,190Z - INFO - Loading correlation features...
2025-11-11 14:54:45,196Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 14:54:45,223Z - INFO - Applied currency/year correlation fallback.
2025-11-11 14:54:46,127Z - INFO - Labels: use_dynamic=True, y_col=direction_cls_dyn, mag_col=magnitude_pips_dyn
2025-11-11 14:54:46,233Z - INFO - Oversampling to max class: before=[205, 355, 228], after=[355, 355, 355]
2025-11-11 14:54:46,233Z - INFO - Time split @ 2025-11-10 07:54:13+00:00: train=788, test=198
2025-11-11 14:54:46,233Z - INFO - Class balance (train): Counter({np.int64(1): 355, np.int64(2): 228, np.int64(0): 205})
2025-11-11 14:54:46,233Z - INFO - Class balance (test): Counter({np.int64(1): 81, np.int64(2): 63, np.int64(0): 54})
2025-11-11 14:54:46,234Z - INFO - Baseline (majority=1) acc=0.4091
2025-11-11 14:54:46,234Z - INFO - Train RandomForest (direction)...
2025-11-11 14:54:47,639Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 14:57:28,569Z - INFO - Best XGB params: {'colsample_bytree': 1.0, 'learning_rate': 0.05, 'max_depth': 6, 'n_estimators': 300, 'subsample': 1.0}
2025-11-11 14:57:31,310Z - INFO - Pred counts (raw): [20, 175, 3]
2025-11-11 14:57:31,310Z - INFO - Avg probs (raw p0,p1,p2): [0.2079, 0.6629, 0.1293]
2025-11-11 14:57:31,311Z - INFO - Train priors: [0.2602, 0.4505, 0.2893], alpha: [1.118, 0.873, 1.066]
2025-11-11 14:57:31,311Z - INFO - Applied post-ensemble bias (p0×1.05, p2×1.18)
2025-11-11 14:57:31,311Z - INFO - Avg probs (adj p0,p1,p2): [0.2395, 0.5992, 0.1613]
2025-11-11 14:57:31,312Z - INFO - Pred counts (adj+margin): [42, 147, 9]
2025-11-11 14:57:31,314Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 5 42  7]
 [18 61  2]
 [19 44  0]]
2025-11-11 14:57:31,325Z - INFO - 
              precision    recall  f1-score   support

           0      0.119     0.093     0.104        54
           1      0.415     0.753     0.535        81
           2      0.000     0.000     0.000        63

    accuracy                          0.333       198
   macro avg      0.178     0.282     0.213       198
weighted avg      0.202     0.333     0.247       198

2025-11-11 14:57:31,328Z - INFO - Ensemble (RF+XGB+BRF) direction: acc=0.3333 f1=0.2131
2025-11-11 14:57:31,328Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 14:57:31,331Z - INFO - Conf>=0.50: coverage=80.30% n=159 acc=0.384 f1=0.214
2025-11-11 14:57:31,334Z - INFO - Conf>=0.55: coverage=61.62% n=122 acc=0.451 f1=0.243
2025-11-11 14:57:31,337Z - INFO - Conf>=0.60: coverage=50.00% n= 99 acc=0.465 f1=0.214
2025-11-11 14:57:31,339Z - INFO - Conf>=0.65: coverage=43.43% n= 86 acc=0.477 f1=0.217
2025-11-11 14:57:31,342Z - INFO - Conf>=0.70: coverage=33.33% n= 66 acc=0.500 f1=0.222
2025-11-11 14:57:31,345Z - INFO - Conf>=0.75: coverage=23.23% n= 46 acc=0.478 f1=0.216
2025-11-11 14:57:31,345Z - INFO - 
=== Trade gate: conf>=0.65 + class-specific cutoffs ===
2025-11-11 14:57:31,348Z - INFO - Trade gate coverage=43.43% n= 86 acc=0.477 f1=0.217
2025-11-11 14:57:31,348Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 14:57:31,361Z - INFO - 
Top 10 best performing events:
2025-11-11 14:57:31,361Z - INFO -   te_stock_market_hong_kong: acc=0.667 (2/3) avg_delta=+1.73 avg_delta_dyn=+0.80 avg_mag=1.13
2025-11-11 14:57:31,361Z - INFO -   te_stock_market_france: acc=0.400 (2/5) avg_delta=+1.02 avg_delta_dyn=+4.34 avg_mag=6.90
2025-11-11 14:57:31,362Z - INFO -   te_stock_market_euro_area: acc=0.400 (2/5) avg_delta=-3.14 avg_delta_dyn=-0.38 avg_mag=3.34
2025-11-11 14:57:31,362Z - INFO -   te_stock_market_united_states: acc=0.400 (2/5) avg_delta=-0.30 avg_delta_dyn=-3.82 avg_mag=4.70
2025-11-11 14:57:31,362Z - INFO -   te_misc_commodity: acc=0.364 (12/33) avg_delta=-0.73 avg_delta_dyn=+0.50 avg_mag=2.73
2025-11-11 14:57:31,362Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=7.27
2025-11-11 14:57:31,362Z - INFO -   te_misc_currency: acc=0.333 (2/6) avg_delta=+0.17 avg_delta_dyn=-0.30 avg_mag=4.97
2025-11-11 14:57:31,363Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-1.23 avg_delta_dyn=+4.10 avg_mag=4.10
2025-11-11 14:57:31,363Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+1.45 avg_delta_dyn=+6.67 avg_mag=6.67
2025-11-11 14:57:31,363Z - INFO -   te_stocks_united_kingdom: acc=0.250 (1/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=5.15
2025-11-11 14:57:31,363Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 14:57:31,363Z - INFO -   te_stock_market_united_states: acc=0.400 (2/5) avg_delta=-0.30 avg_delta_dyn=-3.82 avg_mag=4.70
2025-11-11 14:57:31,364Z - INFO -   te_misc_commodity: acc=0.364 (12/33) avg_delta=-0.73 avg_delta_dyn=+0.50 avg_mag=2.73
2025-11-11 14:57:31,364Z - INFO -   te_stock_market_japan: acc=0.333 (1/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=7.27
2025-11-11 14:57:31,364Z - INFO -   te_misc_currency: acc=0.333 (2/6) avg_delta=+0.17 avg_delta_dyn=-0.30 avg_mag=4.97
2025-11-11 14:57:31,364Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-1.23 avg_delta_dyn=+4.10 avg_mag=4.10
2025-11-11 14:57:31,364Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+1.45 avg_delta_dyn=+6.67 avg_mag=6.67
2025-11-11 14:57:31,365Z - INFO -   te_stocks_united_kingdom: acc=0.250 (1/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=5.15
2025-11-11 14:57:31,365Z - INFO -   te_stock_market_united_kingdom: acc=0.200 (1/5) avg_delta=-0.06 avg_delta_dyn=+3.76 avg_mag=5.88
2025-11-11 14:57:31,365Z - INFO -   te_stock_market_italy: acc=0.000 (0/5) avg_delta=+1.12 avg_delta_dyn=+2.82 avg_mag=5.02
2025-11-11 14:57:31,365Z - INFO -   te_stock_market_india: acc=0.000 (0/3) avg_delta=+2.57 avg_delta_dyn=+2.50 avg_mag=6.37
2025-11-11 14:57:31,563Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 14:58:01,307Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 400}
2025-11-11 14:59:15,117Z - INFO - RMSE magnitude (pips) @+15m: 4.5143
2025-11-11 14:59:15,139Z - INFO - ==== TE V5 Trainer done ====
