2025-11-11 19:00:37,877Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 19:00:37,877Z - INFO - Connecting DB...
2025-11-11 19:00:37,937Z - INFO - DB OK
2025-11-11 19:00:37,937Z - INFO - Loading prices...
2025-11-11 19:02:46,855Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 19:02:50,370Z - INFO - Daily trends (SMA/trend)...
2025-11-11 19:02:51,999Z - INFO - Loading TE news...
2025-11-11 19:02:52,807Z - INFO - Excluded 674 stock-related events with prefixes ('te_stock_market_', 'te_stocks_')
2025-11-11 19:02:52,838Z - INFO - Filtered news piles >20: 9015 removed
2025-11-11 19:02:52,838Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 19:02:53,012Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 19:02:54,977Z - INFO - Dynamic horizon filter: 1230 -> 792 events (removed 438 with horizon < 5m)
2025-11-11 19:02:55,463Z - INFO - Direction classification thresholds mode=linear coeff=0.60, quantile candidate=1.24: min=1.8, coeff=0.6, vol_q=1.24
2025-11-11 19:02:55,463Z - INFO - Threshold range: [1.80, 2.04] pips, median=1.80
2025-11-11 19:02:55,463Z - INFO - Building features...
2025-11-11 19:02:55,477Z - INFO - Loading correlation features...
2025-11-11 19:02:55,586Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 19:02:55,615Z - INFO - Applied currency/year correlation fallback.
2025-11-11 19:02:56,506Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 19:02:56,691Z - INFO - Blocked split purge removed 36 events between train/test blocks
2025-11-11 19:02:56,698Z - INFO - Blocked split freq=W-MON train_periods=['2025-09-30/2025-10-06', '2025-10-07/2025-10-13', '2025-10-14/2025-10-20', '2025-10-21/2025-10-27'] test_periods=['2025-11-04/2025-11-10', '2025-11-11/2025-11-17'] purge=['2025-10-28/2025-11-03']
2025-11-11 19:02:56,699Z - INFO - Overall class distribution after filtering: counts=[133, 354, 269] share=[0.1759, 0.4683, 0.3558]
2025-11-11 19:02:56,702Z - INFO - Time split @ 2025-11-04 00:00:00: train=58, test=698
2025-11-11 19:02:56,702Z - INFO - Class balance (train): Counter({np.int64(1): 31, np.int64(2): 16, np.int64(0): 11})
2025-11-11 19:02:56,702Z - INFO - Class share (train): [0.1897, 0.5345, 0.2759]
2025-11-11 19:02:56,703Z - INFO - Class balance (test): Counter({np.int64(1): 323, np.int64(2): 253, np.int64(0): 122})
2025-11-11 19:02:56,703Z - INFO - Class share (test): [0.1748, 0.4628, 0.3625]
2025-11-11 19:02:56,703Z - INFO - Baseline (majority=1) acc=0.4628
2025-11-11 19:02:56,703Z - INFO - Train RandomForest (direction)...
2025-11-11 19:02:57,660Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 19:04:40,929Z - INFO - Best XGB params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 19:04:41,049Z - INFO - Pred counts (raw): [268, 246, 184]
2025-11-11 19:04:41,049Z - INFO - Avg probs (raw p0,p1,p2): [0.37, 0.3618, 0.2682]
2025-11-11 19:04:41,049Z - INFO - Train priors: [0.1897, 0.5345, 0.2759], alpha disabled
2025-11-11 19:04:41,050Z - INFO - Avg probs (raw p0,p1,p2): [0.37, 0.3618, 0.2682]
2025-11-11 19:04:41,050Z - INFO - Pred counts (adj+margin): [216, 246, 236]
2025-11-11 19:04:41,056Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 41  39  42]
 [111 133  79]
 [ 64  74 115]]
2025-11-11 19:04:41,069Z - INFO - 
              precision    recall  f1-score   support

           0      0.190     0.336     0.243       122
           1      0.541     0.412     0.467       323
           2      0.487     0.455     0.470       253

    accuracy                          0.414       698
   macro avg      0.406     0.401     0.393       698
weighted avg      0.460     0.414     0.429       698

2025-11-11 19:04:41,074Z - INFO - Per-class recall: [0.336, 0.412, 0.455]
2025-11-11 19:04:41,074Z - INFO - Ensemble (RF+XGB) direction: acc=0.4140 f1=0.3935
2025-11-11 19:04:41,079Z - INFO - FX-only subset: n=698 share=100.00% acc=0.4140 macroF1=0.3935
