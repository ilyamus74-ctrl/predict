2025-11-11 10:13:08,076Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 10:13:08,076Z - INFO - Connecting DB...
2025-11-11 10:13:08,126Z - INFO - DB OK
2025-11-11 10:13:08,127Z - INFO - Loading prices...
2025-11-11 10:15:09,793Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 10:15:13,773Z - INFO - Daily trends (SMA/trend)...
2025-11-11 10:15:15,435Z - INFO - Loading TE news...
2025-11-11 10:15:22,530Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 10:15:22,530Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 10:15:23,676Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 10:15:25,873Z - INFO - Dynamic horizon filter: 1412 -> 749 events (removed 663 with horizon < 5m)
2025-11-11 10:15:26,429Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 10:15:26,429Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 10:15:26,429Z - INFO - Building features...
2025-11-11 10:15:26,439Z - INFO - Loading correlation features...
2025-11-11 10:15:26,779Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 10:15:26,897Z - INFO - Applied currency/year correlation fallback.
2025-11-11 10:15:27,939Z - WARNING - Dropping constant features: ['imp_year_trend', 'price_change', 'corr_direction', 'probability', 'observations']
2025-11-11 10:15:28,010Z - INFO - Time split @ 2025-11-10 08:55:25.600000+00:00: train=599, test=150
2025-11-11 10:15:28,010Z - INFO - Class balance (train): Counter({np.int64(1): 289, np.int64(2): 175, np.int64(0): 135})
2025-11-11 10:15:28,010Z - INFO - Class balance (test): Counter({np.int64(0): 51, np.int64(1): 50, np.int64(2): 49})
2025-11-11 10:15:28,011Z - INFO - Baseline (majority=1) acc=0.3333
2025-11-11 10:15:28,011Z - INFO - Train RandomForest (direction)...
2025-11-11 10:15:29,271Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 10:16:19,368Z - INFO - Best XGB params: {'colsample_bytree': 0.7, 'learning_rate': 0.03, 'max_depth': 6, 'n_estimators': 200, 'subsample': 1.0}
2025-11-11 10:16:22,977Z - INFO - Pred counts (0,1,2): [11, 132, 7]
2025-11-11 10:16:22,978Z - INFO - Avg probs (p0,p1,p2): [np.float64(0.2113), np.float64(0.5911), np.float64(0.1976)]
2025-11-11 10:16:22,984Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 0 45  6]
 [ 8 41  1]
 [ 3 46  0]]
2025-11-11 10:16:23,000Z - INFO - 
              precision    recall  f1-score   support

           0      0.000     0.000     0.000        51
           1      0.311     0.820     0.451        50
           2      0.000     0.000     0.000        49

    accuracy                          0.273       150
   macro avg      0.104     0.273     0.150       150
weighted avg      0.104     0.273     0.150       150

2025-11-11 10:16:23,006Z - INFO - Ensemble (RF+XGB) direction: acc=0.2733 f1=0.1502
2025-11-11 10:16:23,006Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 10:16:23,010Z - INFO - Conf>=0.50: coverage=73.33% n=110 acc=0.336 f1=0.170
2025-11-11 10:16:23,014Z - INFO - Conf>=0.55: coverage=62.00% n= 93 acc=0.387 f1=0.186
2025-11-11 10:16:23,018Z - INFO - Conf>=0.60: coverage=49.33% n= 74 acc=0.392 f1=0.188
2025-11-11 10:16:23,021Z - INFO - Conf>=0.65: coverage=36.00% n= 54 acc=0.333 f1=0.167
2025-11-11 10:16:23,024Z - INFO - Conf>=0.70: coverage=25.33% n= 38 acc=0.289 f1=0.150
2025-11-11 10:16:23,026Z - INFO - Conf>=0.75: coverage=13.33% n= 20 acc=0.300 f1=0.154
2025-11-11 10:16:23,029Z - INFO - Class-thresholds {0: 0.55, 1: 0.62, 2: 0.55}: coverage=44.00% n=66 acc=0.379 f1=0.183
2025-11-11 10:16:23,033Z - INFO - Class-thresholds {0: 0.6, 1: 0.64, 2: 0.58}: coverage=37.33% n=56 acc=0.321 f1=0.162
2025-11-11 10:16:23,033Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 10:16:23,047Z - INFO - 
Top 10 best performing events:
2025-11-11 10:16:23,047Z - INFO -   te_stock_market_united_states: acc=0.500 (2/4) avg_delta=-1.80 avg_mag=1.80
2025-11-11 10:16:23,047Z - INFO -   te_misc_currency: acc=0.400 (2/5) avg_delta=+0.48 avg_mag=2.20
2025-11-11 10:16:23,047Z - INFO -   te_misc_commodity: acc=0.370 (10/27) avg_delta=-1.08 avg_mag=2.65
2025-11-11 10:16:23,048Z - INFO -   te_stock_market_united_kingdom: acc=0.333 (1/3) avg_delta=+0.37 avg_mag=1.37
2025-11-11 10:16:23,048Z - INFO -   te_stock_market_japan: acc=0.000 (0/3) avg_delta=-4.73 avg_mag=4.73
2025-11-11 10:16:23,048Z - INFO -   te_stocks_united_kingdom: acc=0.000 (0/3) avg_delta=-1.03 avg_mag=2.10
2025-11-11 10:16:23,048Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 10:16:23,049Z - INFO -   te_stock_market_united_states: acc=0.500 (2/4) avg_delta=-1.80 avg_mag=1.80
2025-11-11 10:16:23,049Z - INFO -   te_misc_currency: acc=0.400 (2/5) avg_delta=+0.48 avg_mag=2.20
2025-11-11 10:16:23,049Z - INFO -   te_misc_commodity: acc=0.370 (10/27) avg_delta=-1.08 avg_mag=2.65
2025-11-11 10:16:23,049Z - INFO -   te_stock_market_united_kingdom: acc=0.333 (1/3) avg_delta=+0.37 avg_mag=1.37
2025-11-11 10:16:23,049Z - INFO -   te_stock_market_japan: acc=0.000 (0/3) avg_delta=-4.73 avg_mag=4.73
2025-11-11 10:16:23,050Z - INFO -   te_stocks_united_kingdom: acc=0.000 (0/3) avg_delta=-1.03 avg_mag=2.10
2025-11-11 10:16:23,217Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 10:16:25,564Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 400}
2025-11-11 10:16:25,569Z - INFO - RMSE magnitude (pips) @+15m: 4.2751
2025-11-11 10:16:25,575Z - INFO - ==== TE V5 Trainer done ====
