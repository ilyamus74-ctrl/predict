2025-11-11 19:27:45,252Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 19:27:45,252Z - INFO - Connecting DB...
2025-11-11 19:27:45,309Z - INFO - DB OK
2025-11-11 19:27:45,309Z - INFO - Loading prices...
2025-11-11 19:29:25,678Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 19:29:28,992Z - INFO - Daily trends (SMA/trend)...
2025-11-11 19:29:30,494Z - INFO - Loading TE news...
2025-11-11 19:29:31,133Z - INFO - Excluded 678 stock-related events with prefixes ('te_stock_market_', 'te_stocks_')
2025-11-11 19:29:31,163Z - INFO - Filtered news piles >20: 9015 removed
2025-11-11 19:29:31,163Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 19:29:31,178Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 19:29:33,116Z - INFO - Dynamic horizon filter: 1230 -> 794 events (removed 436 with horizon < 5m)
2025-11-11 19:29:33,588Z - INFO - Direction classification thresholds mode=linear coeff=0.60, quantile candidate=1.24: min=1.8, coeff=0.6, vol_q=1.24
2025-11-11 19:29:33,589Z - INFO - Threshold range: [1.80, 2.04] pips, median=1.80
2025-11-11 19:29:33,589Z - INFO - Building features...
2025-11-11 19:29:33,601Z - INFO - Loading correlation features...
2025-11-11 19:29:33,606Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 19:29:33,627Z - INFO - Applied currency/year correlation fallback.
2025-11-11 19:29:34,519Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 19:29:34,584Z - INFO - Blocked split purge removed 36 events between train/test blocks
2025-11-11 19:29:34,588Z - INFO - Blocked split freq=W-MON train_periods=['2025-09-30/2025-10-06', '2025-10-07/2025-10-13', '2025-10-14/2025-10-20', '2025-10-21/2025-10-27'] test_periods=['2025-11-04/2025-11-10', '2025-11-11/2025-11-17'] purge=['2025-10-28/2025-11-03']
2025-11-11 19:29:34,589Z - INFO - Overall class distribution after filtering: counts=[140, 343, 275] share=[0.1847, 0.4525, 0.3628]
2025-11-11 19:29:34,592Z - INFO - Time split @ 2025-11-04 00:00:00: train=58, test=700
2025-11-11 19:29:34,592Z - INFO - Class balance (train): Counter({np.int64(1): 31, np.int64(2): 16, np.int64(0): 11})
2025-11-11 19:29:34,592Z - INFO - Class share (train): [0.1897, 0.5345, 0.2759]
2025-11-11 19:29:34,592Z - INFO - Class balance (test): Counter({np.int64(1): 312, np.int64(2): 259, np.int64(0): 129})
2025-11-11 19:29:34,592Z - INFO - Class share (test): [0.1843, 0.4457, 0.37]
2025-11-11 19:29:34,593Z - INFO - Baseline (majority=1) acc=0.4457
2025-11-11 19:29:34,593Z - INFO - Train RandomForest (direction)...
2025-11-11 19:29:35,833Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 19:29:38,338Z - INFO - Best XGB params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 19:29:38,585Z - INFO - Pred counts (raw): [272, 246, 182]
2025-11-11 19:29:38,585Z - INFO - Avg probs (raw p0,p1,p2): [0.3708, 0.3615, 0.2677]
2025-11-11 19:29:38,585Z - INFO - Train priors: [0.1897, 0.5345, 0.2759], alpha disabled
2025-11-11 19:29:38,585Z - INFO - Avg probs (raw p0,p1,p2): [0.3708, 0.3615, 0.2677]
2025-11-11 19:29:38,585Z - INFO - Pred counts (adj+margin): [217, 246, 237]
2025-11-11 19:29:38,587Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 43  43  43]
 [110 126  76]
 [ 64  77 118]]
2025-11-11 19:29:38,596Z - INFO - 
              precision    recall  f1-score   support

           0      0.198     0.333     0.249       129
           1      0.512     0.404     0.452       312
           2      0.498     0.456     0.476       259

    accuracy                          0.410       700
   macro avg      0.403     0.398     0.392       700
weighted avg      0.449     0.410     0.423       700

2025-11-11 19:29:38,598Z - INFO - Per-class recall: [0.333, 0.404, 0.456]
2025-11-11 19:29:38,598Z - INFO - Ensemble (RF+XGB) direction: acc=0.4100 f1=0.3920
2025-11-11 19:29:38,602Z - INFO - FX-only subset: n=700 share=100.00% acc=0.4100 macroF1=0.3920
2025-11-11 19:29:38,833Z - INFO - 
[2-stage] Confusion (0,1,2 rows vs cols):
[[ 25  81  23]
 [ 52 230  30]
 [ 88 113  58]]
2025-11-11 19:29:38,833Z - INFO - [2-stage] acc=0.4471 macroF1=0.3695 move_cov=0.39
2025-11-11 19:29:38,833Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 19:29:38,836Z - INFO - Conf>=0.50: coverage=73.57% n=515 acc=0.410 f1=0.394
2025-11-11 19:29:38,838Z - INFO - Conf>=0.55: coverage=54.14% n=379 acc=0.425 f1=0.396
2025-11-11 19:29:38,841Z - INFO - Conf>=0.60: coverage=40.86% n=286 acc=0.423 f1=0.396
2025-11-11 19:29:38,844Z - INFO - Conf>=0.65: coverage=28.71% n=201 acc=0.413 f1=0.373
2025-11-11 19:29:38,846Z - INFO - Conf>=0.70: coverage= 8.71% n= 61 acc=0.377 f1=0.387
2025-11-11 19:29:38,848Z - INFO - Conf>=0.75: coverage= 1.43% n= 10 acc=0.800 f1=0.314
2025-11-11 19:29:38,849Z - INFO - 
=== Trade gate (FX-only) ===
2025-11-11 19:29:38,849Z - INFO - Trade gate thresholds: conf>=0.72, p_move>=0.68, margin>=0.10
2025-11-11 19:29:38,851Z - INFO - Trade gate coverage_total= 4.43% coverage_fx= 4.43% n= 31 acc=0.129 macroF1=0.101
2025-11-11 19:29:38,852Z - INFO - Acceptance check: overall_ok=True (macroF1=0.392, recall2=0.456) trade_ok=False (cov=0.044 acc=0.129)
2025-11-11 19:29:38,852Z - INFO - Criteria not met -> scanning threshold/gate grid (no retraining, what-if analysis)
2025-11-11 19:29:39,368Z - INFO - Best grid combo: thr_min=1.80 thr_coeff=0.55 conf=0.70 move=0.65 margin=0.05 | f1=0.392 recall2=0.456 cov=0.071 acc_trade=0.200 f1_trade=0.151 main_ok=True gate_ok=False
2025-11-11 19:29:39,368Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 19:29:39,379Z - INFO - 
Top 10 best performing events:
2025-11-11 19:29:39,380Z - INFO -   te_currency_japan: acc=1.000 (3/3) avg_delta=+0.57 avg_delta_dyn=-1.23 avg_mag=0.90
2025-11-11 19:29:39,380Z - INFO -   te_currency_united_states: acc=0.667 (2/3) avg_delta=+0.50 avg_delta_dyn=-1.03 avg_mag=0.50
2025-11-11 19:29:39,380Z - INFO -   te_news_india: acc=0.667 (2/3) avg_delta=+1.33 avg_delta_dyn=+0.43 avg_mag=1.33
2025-11-11 19:29:39,380Z - INFO -   te_indicator_stream: acc=0.571 (4/7) avg_delta=+0.03 avg_delta_dyn=-1.87 avg_mag=3.20
2025-11-11 19:29:39,380Z - INFO -   te_misc_all: acc=0.361 (13/36) avg_delta=+0.62 avg_delta_dyn=+0.99 avg_mag=2.48
2025-11-11 19:29:39,381Z - INFO -   te_currency_brazil: acc=0.333 (1/3) avg_delta=-0.60 avg_delta_dyn=+1.93 avg_mag=2.73
2025-11-11 19:29:39,381Z - INFO -   te_government_bond_10y_united_states: acc=0.333 (1/3) avg_delta=-1.40 avg_delta_dyn=+1.87 avg_mag=1.40
2025-11-11 19:29:39,381Z - INFO -   te_misc_commodity: acc=0.312 (15/48) avg_delta=-1.14 avg_delta_dyn=+0.45 avg_mag=2.34
2025-11-11 19:29:39,381Z - INFO -   te_misc_currency: acc=0.200 (2/10) avg_delta=-0.35 avg_delta_dyn=-1.42 avg_mag=1.69
2025-11-11 19:29:39,382Z - INFO -   te_currency_united_kingdom: acc=0.000 (0/3) avg_delta=+2.03 avg_delta_dyn=+4.07 avg_mag=2.03
2025-11-11 19:29:39,382Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 19:29:39,382Z - INFO -   te_currency_japan: acc=1.000 (3/3) avg_delta=+0.57 avg_delta_dyn=-1.23 avg_mag=0.90
2025-11-11 19:29:39,382Z - INFO -   te_currency_united_states: acc=0.667 (2/3) avg_delta=+0.50 avg_delta_dyn=-1.03 avg_mag=0.50
2025-11-11 19:29:39,383Z - INFO -   te_news_india: acc=0.667 (2/3) avg_delta=+1.33 avg_delta_dyn=+0.43 avg_mag=1.33
2025-11-11 19:29:39,383Z - INFO -   te_indicator_stream: acc=0.571 (4/7) avg_delta=+0.03 avg_delta_dyn=-1.87 avg_mag=3.20
2025-11-11 19:29:39,383Z - INFO -   te_misc_all: acc=0.361 (13/36) avg_delta=+0.62 avg_delta_dyn=+0.99 avg_mag=2.48
2025-11-11 19:29:39,383Z - INFO -   te_currency_brazil: acc=0.333 (1/3) avg_delta=-0.60 avg_delta_dyn=+1.93 avg_mag=2.73
2025-11-11 19:29:39,383Z - INFO -   te_government_bond_10y_united_states: acc=0.333 (1/3) avg_delta=-1.40 avg_delta_dyn=+1.87 avg_mag=1.40
2025-11-11 19:29:39,384Z - INFO -   te_misc_commodity: acc=0.312 (15/48) avg_delta=-1.14 avg_delta_dyn=+0.45 avg_mag=2.34
2025-11-11 19:29:39,384Z - INFO -   te_misc_currency: acc=0.200 (2/10) avg_delta=-0.35 avg_delta_dyn=-1.42 avg_mag=1.69
2025-11-11 19:29:39,384Z - INFO -   te_currency_united_kingdom: acc=0.000 (0/3) avg_delta=+2.03 avg_delta_dyn=+4.07 avg_mag=2.03
2025-11-11 19:29:39,384Z - INFO - 
=== FX-only performance (event types, top 10) ===
2025-11-11 19:29:39,390Z - INFO -   te_currency_japan: acc=1.000 (3/3) avg_delta=+0.57
2025-11-11 19:29:39,390Z - INFO -   te_currency_united_states: acc=0.667 (2/3) avg_delta=+0.50
2025-11-11 19:29:39,390Z - INFO -   te_news_india: acc=0.667 (2/3) avg_delta=+1.33
2025-11-11 19:29:39,390Z - INFO -   te_indicator_stream: acc=0.571 (4/7) avg_delta=+0.03
2025-11-11 19:29:39,391Z - INFO -   te_misc_all: acc=0.361 (13/36) avg_delta=+0.62
2025-11-11 19:29:39,391Z - INFO -   te_currency_brazil: acc=0.333 (1/3) avg_delta=-0.60
2025-11-11 19:29:39,391Z - INFO -   te_government_bond_10y_united_states: acc=0.333 (1/3) avg_delta=-1.40
2025-11-11 19:29:39,391Z - INFO -   te_misc_commodity: acc=0.312 (15/48) avg_delta=-1.14
2025-11-11 19:29:39,391Z - INFO -   te_misc_currency: acc=0.200 (2/10) avg_delta=-0.35
2025-11-11 19:29:39,391Z - INFO -   te_currency_united_kingdom: acc=0.000 (0/3) avg_delta=+2.03
2025-11-11 19:29:39,515Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 19:29:40,133Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 19:29:40,467Z - INFO - RMSE magnitude (pips) @+15m: 2.2113
2025-11-11 19:29:40,475Z - INFO - ==== TE V5 Trainer done ====
