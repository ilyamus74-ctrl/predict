2025-11-11 20:11:20,054Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 20:11:20,054Z - INFO - Connecting DB...
2025-11-11 20:11:20,139Z - INFO - DB OK
2025-11-11 20:11:20,139Z - INFO - Loading prices...
2025-11-11 20:13:09,640Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 20:13:12,936Z - INFO - Daily trends (SMA/trend)...
2025-11-11 20:13:14,450Z - INFO - Loading TE news...
2025-11-11 20:13:14,662Z - INFO - Excluded 679 stock-related events with prefixes ('te_stock_market_', 'te_stocks_')
2025-11-11 20:13:14,690Z - INFO - Filtered news piles >80: 8436 removed
2025-11-11 20:13:14,690Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 20:13:14,770Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 20:13:16,693Z - INFO - Dynamic horizon filter: 1811 -> 829 events (removed 982 with horizon < 3m)
2025-11-11 20:13:17,172Z - INFO - Direction classification thresholds mode=linear coeff=0.60, quantile candidate=1.24: min=1.8, coeff=0.6, vol_q=1.24
2025-11-11 20:13:17,173Z - INFO - Threshold range: [1.80, 2.04] pips, median=1.80
2025-11-11 20:13:17,173Z - INFO - Building features...
2025-11-11 20:13:17,185Z - INFO - Loading correlation features...
2025-11-11 20:13:17,294Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 20:13:17,322Z - INFO - Applied currency/year correlation fallback.
2025-11-11 20:13:18,187Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 20:13:18,276Z - INFO - Blocked split freq=W-MON train_periods=['2025-10-06', '2025-10-08', '2025-10-09', '2025-10-10', '2025-10-12', '2025-10-13', '2025-10-14', '2025-10-15', '2025-10-16', '2025-10-17', '2025-10-19', '2025-10-20', '2025-10-21', '2025-10-22', '2025-10-23', '2025-10-24', '2025-10-26', '2025-10-27', '2025-10-28', '2025-10-29', '2025-10-30', '2025-10-31', '2025-11-02', '2025-11-03'] test_periods=['2025-11-04', '2025-11-05', '2025-11-06', '2025-11-07', '2025-11-09', '2025-11-10', '2025-11-11'] purge=[]
2025-11-11 20:13:18,282Z - INFO - Overall class distribution after filtering: counts=[143, 384, 302] share=[0.1725, 0.4632, 0.3643]
2025-11-11 20:13:18,288Z - INFO - Time split @ 2025-11-04 00:00:00: train=117, test=712
2025-11-11 20:13:18,289Z - INFO - Class balance (train): Counter({np.int64(1): 60, np.int64(2): 33, np.int64(0): 24})
2025-11-11 20:13:18,289Z - INFO - Class share (train): [0.2051, 0.5128, 0.2821]
2025-11-11 20:13:18,289Z - INFO - Class balance (test): Counter({np.int64(1): 324, np.int64(2): 269, np.int64(0): 119})
2025-11-11 20:13:18,290Z - INFO - Class share (test): [0.1671, 0.4551, 0.3778]
2025-11-11 20:13:18,290Z - INFO - Baseline (majority=1) acc=0.4551
2025-11-11 20:13:18,290Z - INFO - Train RandomForest (direction)...
2025-11-11 20:13:19,380Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 20:14:03,481Z - INFO - Best XGB params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 300}
2025-11-11 20:14:03,616Z - INFO - Pred counts (raw): [354, 146, 212]
2025-11-11 20:14:03,616Z - INFO - Avg probs (raw p0,p1,p2): [0.4407, 0.2625, 0.2968]
2025-11-11 20:14:03,617Z - INFO - Train priors: [0.2051, 0.5128, 0.2821], alpha disabled
2025-11-11 20:14:03,617Z - INFO - Avg probs (raw p0,p1,p2): [0.4407, 0.2625, 0.2968]
2025-11-11 20:14:03,617Z - INFO - Pred counts (adj+margin): [214, 146, 352]
2025-11-11 20:14:03,620Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 41  20  58]
 [ 71 100 153]
 [102  26 141]]
2025-11-11 20:14:03,629Z - INFO - 
              precision    recall  f1-score   support

           0      0.192     0.345     0.246       119
           1      0.685     0.309     0.426       324
           2      0.401     0.524     0.454       269

    accuracy                          0.396       712
   macro avg      0.426     0.392     0.375       712
weighted avg      0.495     0.396     0.406       712

2025-11-11 20:14:03,631Z - INFO - Per-class recall: [0.345, 0.309, 0.524]
2025-11-11 20:14:03,631Z - INFO - Ensemble (RF+XGB) direction: acc=0.3961 f1=0.3753
2025-11-11 20:14:03,634Z - INFO - FX-only subset: n=712 share=100.00% acc=0.3961 macroF1=0.3753
2025-11-11 20:14:03,922Z - INFO - 
[2-stage] Confusion (0,1,2 rows vs cols):
[[ 76  12  31]
 [196  73  55]
 [201  25  43]]
2025-11-11 20:14:03,922Z - INFO - [2-stage] acc=0.2697 macroF1=0.2697 move_cov=0.85
2025-11-11 20:14:03,923Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 20:14:03,925Z - INFO - Conf>=0.50: coverage=63.48% n=452 acc=0.394 f1=0.364
2025-11-11 20:14:03,927Z - INFO - Conf>=0.55: coverage=46.91% n=334 acc=0.398 f1=0.362
2025-11-11 20:14:03,929Z - INFO - Conf>=0.60: coverage=35.39% n=252 acc=0.401 f1=0.362
2025-11-11 20:14:03,932Z - INFO - Conf>=0.65: coverage=24.02% n=171 acc=0.409 f1=0.380
2025-11-11 20:14:03,934Z - INFO - Conf>=0.70: coverage=18.54% n=132 acc=0.417 f1=0.395
2025-11-11 20:14:03,937Z - INFO - Conf>=0.75: coverage=11.38% n= 81 acc=0.358 f1=0.355
2025-11-11 20:14:03,937Z - INFO - 
=== Trade gate (FX-only) ===
2025-11-11 20:14:03,937Z - INFO - Trade gate thresholds: conf>=0.72, p_move>=0.68, margin>=0.10
2025-11-11 20:14:03,939Z - INFO - Trade gate coverage_total=14.61% coverage_fx=14.61% n=104 acc=0.087 macroF1=0.053
2025-11-11 20:14:03,940Z - INFO - Acceptance check: overall_ok=True (macroF1=0.375, recall2=0.524) trade_ok=False (cov=0.146 acc=0.087)
2025-11-11 20:14:03,940Z - INFO - Criteria not met -> scanning threshold/gate grid (no retraining, what-if analysis)
2025-11-11 20:14:04,720Z - INFO - Best grid combo: thr_min=1.80 thr_coeff=0.55 conf=0.70 move=0.60 margin=0.05 | f1=0.375 recall2=0.524 cov=0.170 acc_trade=0.132 f1_trade=0.078 main_ok=True gate_ok=False
2025-11-11 20:14:04,721Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 20:14:04,735Z - INFO - 
Top 10 best performing events:
2025-11-11 20:14:04,735Z - INFO -   te_currency_japan: acc=1.000 (3/3) avg_delta=+0.57 avg_delta_dyn=-1.23 avg_mag=0.90
2025-11-11 20:14:04,736Z - INFO -   te_currency_united_states: acc=0.667 (2/3) avg_delta=+0.50 avg_delta_dyn=-1.03 avg_mag=0.50
2025-11-11 20:14:04,736Z - INFO -   te_news_india: acc=0.667 (2/3) avg_delta=+1.33 avg_delta_dyn=+0.43 avg_mag=1.33
2025-11-11 20:14:04,736Z - INFO -   te_indicator_stream: acc=0.571 (8/14) avg_delta=+1.25 avg_delta_dyn=-0.90 avg_mag=2.95
2025-11-11 20:14:04,736Z - INFO -   te_misc_currency: acc=0.500 (5/10) avg_delta=+0.67 avg_delta_dyn=-0.43 avg_mag=1.71
2025-11-11 20:14:04,737Z - INFO -   te_misc_all: acc=0.410 (16/39) avg_delta=+0.71 avg_delta_dyn=+1.10 avg_mag=2.43
2025-11-11 20:14:04,737Z - INFO -   te_currency_brazil: acc=0.333 (1/3) avg_delta=+2.80 avg_delta_dyn=+5.23 avg_mag=2.80
2025-11-11 20:14:04,737Z - INFO -   te_government_bond_10y_united_states: acc=0.333 (1/3) avg_delta=-0.40 avg_delta_dyn=-3.57 avg_mag=1.20
2025-11-11 20:14:04,737Z - INFO -   te_misc_commodity: acc=0.292 (14/48) avg_delta=-0.97 avg_delta_dyn=+0.38 avg_mag=2.23
2025-11-11 20:14:04,737Z - INFO -   te_currency_united_kingdom: acc=0.000 (0/3) avg_delta=+2.03 avg_delta_dyn=+4.07 avg_mag=2.03
2025-11-11 20:14:04,737Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 20:14:04,738Z - INFO -   te_currency_japan: acc=1.000 (3/3) avg_delta=+0.57 avg_delta_dyn=-1.23 avg_mag=0.90
2025-11-11 20:14:04,738Z - INFO -   te_currency_united_states: acc=0.667 (2/3) avg_delta=+0.50 avg_delta_dyn=-1.03 avg_mag=0.50
2025-11-11 20:14:04,738Z - INFO -   te_news_india: acc=0.667 (2/3) avg_delta=+1.33 avg_delta_dyn=+0.43 avg_mag=1.33
2025-11-11 20:14:04,739Z - INFO -   te_indicator_stream: acc=0.571 (8/14) avg_delta=+1.25 avg_delta_dyn=-0.90 avg_mag=2.95
2025-11-11 20:14:04,739Z - INFO -   te_misc_currency: acc=0.500 (5/10) avg_delta=+0.67 avg_delta_dyn=-0.43 avg_mag=1.71
2025-11-11 20:14:04,739Z - INFO -   te_misc_all: acc=0.410 (16/39) avg_delta=+0.71 avg_delta_dyn=+1.10 avg_mag=2.43
2025-11-11 20:14:04,739Z - INFO -   te_currency_brazil: acc=0.333 (1/3) avg_delta=+2.80 avg_delta_dyn=+5.23 avg_mag=2.80
2025-11-11 20:14:04,739Z - INFO -   te_government_bond_10y_united_states: acc=0.333 (1/3) avg_delta=-0.40 avg_delta_dyn=-3.57 avg_mag=1.20
2025-11-11 20:14:04,739Z - INFO -   te_misc_commodity: acc=0.292 (14/48) avg_delta=-0.97 avg_delta_dyn=+0.38 avg_mag=2.23
2025-11-11 20:14:04,740Z - INFO -   te_currency_united_kingdom: acc=0.000 (0/3) avg_delta=+2.03 avg_delta_dyn=+4.07 avg_mag=2.03
2025-11-11 20:14:04,740Z - INFO - 
=== FX-only performance (event types, top 10) ===
2025-11-11 20:14:04,746Z - INFO -   te_currency_japan: acc=1.000 (3/3) avg_delta=+0.57
2025-11-11 20:14:04,746Z - INFO -   te_currency_united_states: acc=0.667 (2/3) avg_delta=+0.50
2025-11-11 20:14:04,746Z - INFO -   te_news_india: acc=0.667 (2/3) avg_delta=+1.33
2025-11-11 20:14:04,746Z - INFO -   te_indicator_stream: acc=0.571 (8/14) avg_delta=+1.25
2025-11-11 20:14:04,747Z - INFO -   te_misc_currency: acc=0.500 (5/10) avg_delta=+0.67
2025-11-11 20:14:04,747Z - INFO -   te_misc_all: acc=0.410 (16/39) avg_delta=+0.71
2025-11-11 20:14:04,747Z - INFO -   te_currency_brazil: acc=0.333 (1/3) avg_delta=+2.80
2025-11-11 20:14:04,747Z - INFO -   te_government_bond_10y_united_states: acc=0.333 (1/3) avg_delta=-0.40
2025-11-11 20:14:04,748Z - INFO -   te_misc_commodity: acc=0.292 (14/48) avg_delta=-0.97
2025-11-11 20:14:04,748Z - INFO -   te_currency_united_kingdom: acc=0.000 (0/3) avg_delta=+2.03
2025-11-11 20:14:04,894Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 20:14:05,830Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 20:14:06,307Z - INFO - RMSE magnitude (pips) @+15m: 2.2772
2025-11-11 20:14:06,316Z - INFO - ==== TE V5 Trainer done ====
