2025-11-11 17:48:44,899Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 17:48:44,899Z - INFO - Connecting DB...
2025-11-11 17:48:44,959Z - INFO - DB OK
2025-11-11 17:48:44,959Z - INFO - Loading prices...
2025-11-11 17:50:28,795Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 17:50:32,551Z - INFO - Daily trends (SMA/trend)...
2025-11-11 17:50:34,248Z - INFO - Loading TE news...
2025-11-11 17:50:35,106Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 17:50:35,106Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 17:50:35,120Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 17:50:37,100Z - INFO - Dynamic horizon filter: 1463 -> 1006 events (removed 457 with horizon < 5m)
2025-11-11 17:50:37,618Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 17:50:37,618Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 17:50:37,618Z - INFO - Building features...
2025-11-11 17:50:37,632Z - INFO - Loading correlation features...
2025-11-11 17:50:37,639Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 17:50:37,665Z - INFO - Applied currency/year correlation fallback.
2025-11-11 17:50:38,563Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 17:50:38,658Z - INFO - Time split @ 2025-11-10 08:54:14+00:00: train=655, test=202
2025-11-11 17:50:38,658Z - INFO - Time split @ 2025-11-10 08:54:14+00:00: train=655, test=202
2025-11-11 17:50:38,658Z - INFO - Class balance (train): Counter({np.int64(2): 323, np.int64(1): 207, np.int64(0): 125})
2025-11-11 17:50:38,659Z - INFO - Class balance (test): Counter({np.int64(0): 79, np.int64(2): 62, np.int64(1): 61})
2025-11-11 17:50:38,659Z - INFO - Baseline (majority=2) acc=0.3069
2025-11-11 17:50:38,659Z - INFO - Train RandomForest (direction)...
2025-11-11 17:50:39,689Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 17:53:27,328Z - INFO - Best XGB params: {'learning_rate': 0.1, 'max_depth': 6, 'n_estimators': 200}
2025-11-11 17:53:27,460Z - INFO - Pred counts (raw): [108, 88, 6]
2025-11-11 17:53:27,460Z - INFO - Avg probs (raw p0,p1,p2): [0.4277, 0.4682, 0.1041]
2025-11-11 17:53:27,461Z - INFO - Train priors: [0.1908, 0.316, 0.4931], alpha: [1.087, 1.008, 0.943]
2025-11-11 17:53:27,461Z - INFO - Avg probs (calibrated p0,p1,p2): [0.4378, 0.4563, 0.1059]
2025-11-11 17:53:27,461Z - INFO - Pred counts (adj+margin): [111, 83, 8]
2025-11-11 17:53:27,464Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[50 26  3]
 [30 29  2]
 [31 28  3]]
2025-11-11 17:53:27,473Z - INFO - 
              precision    recall  f1-score   support

           0      0.450     0.633     0.526        79
           1      0.349     0.475     0.403        61
           2      0.375     0.048     0.086        62

    accuracy                          0.406       202
   macro avg      0.392     0.386     0.338       202
weighted avg      0.397     0.406     0.354       202

2025-11-11 17:53:27,476Z - INFO - Ensemble (RF+XGB) direction: acc=0.4059 f1=0.3383
2025-11-11 17:54:03,484Z - INFO - 
[2-stage] Confusion (0,1,2 rows vs cols):
[[59 13  7]
 [37 22  2]
 [36 19  7]]
2025-11-11 17:54:03,485Z - INFO - [2-stage] acc=0.4356 macroF1=0.3738 move_cov=0.73
2025-11-11 17:54:03,485Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 17:54:03,487Z - INFO - Conf>=0.50: coverage=81.19% n=164 acc=0.439 f1=0.355
2025-11-11 17:54:03,490Z - INFO - Conf>=0.55: coverage=58.91% n=119 acc=0.462 f1=0.381
2025-11-11 17:54:03,492Z - INFO - Conf>=0.60: coverage=44.06% n= 89 acc=0.483 f1=0.392
2025-11-11 17:54:03,495Z - INFO - Conf>=0.65: coverage=24.75% n= 50 acc=0.500 f1=0.388
2025-11-11 17:54:03,497Z - INFO - Conf>=0.70: coverage= 9.41% n= 19 acc=0.579 f1=0.244
2025-11-11 17:54:03,499Z - INFO - Conf>=0.75: coverage= 6.93% n= 14 acc=0.571 f1=0.242
2025-11-11 17:54:03,500Z - INFO - 
=== Trade gate: conf>=0.65 + p_move>=0.60 + margin>=0.05 (FX-only) ===
2025-11-11 17:54:03,503Z - INFO - Trade gate coverage= 8.42% n= 17 acc=0.471 f1=0.213
2025-11-11 17:54:03,503Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 17:54:03,515Z - INFO - 
Top 10 best performing events:
2025-11-11 17:54:03,516Z - INFO -   te_stock_market_indonesia: acc=1.000 (3/3) avg_delta=-2.30 avg_delta_dyn=+3.60 avg_mag=2.30
2025-11-11 17:54:03,516Z - INFO -   te_stock_market_euro_area: acc=0.750 (3/4) avg_delta=-3.30 avg_delta_dyn=+5.62 avg_mag=4.40
2025-11-11 17:54:03,516Z - INFO -   te_stock_market_france: acc=0.750 (3/4) avg_delta=+1.25 avg_delta_dyn=+5.08 avg_mag=2.35
2025-11-11 17:54:03,516Z - INFO -   te_misc_currency: acc=0.714 (5/7) avg_delta=-0.26 avg_delta_dyn=-1.04 avg_mag=2.17
2025-11-11 17:54:03,516Z - INFO -   te_stock_market_japan: acc=0.667 (2/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=4.73
2025-11-11 17:54:03,516Z - INFO -   te_stock_market_united_states: acc=0.571 (4/7) avg_delta=-2.56 avg_delta_dyn=-3.69 avg_mag=2.70
2025-11-11 17:54:03,517Z - INFO -   te_misc_commodity: acc=0.514 (18/35) avg_delta=-1.04 avg_delta_dyn=+0.38 avg_mag=2.45
2025-11-11 17:54:03,517Z - INFO -   te_stock_market_canada: acc=0.500 (2/4) avg_delta=-2.23 avg_delta_dyn=-2.65 avg_mag=7.17
2025-11-11 17:54:03,517Z - INFO -   te_stocks_united_kingdom: acc=0.500 (2/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 17:54:03,517Z - INFO -   te_stock_market_italy: acc=0.500 (2/4) avg_delta=-2.42 avg_delta_dyn=+0.28 avg_mag=4.03
2025-11-11 17:54:03,517Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 17:54:03,517Z - INFO -   te_stock_market_france: acc=0.750 (3/4) avg_delta=+1.25 avg_delta_dyn=+5.08 avg_mag=2.35
2025-11-11 17:54:03,518Z - INFO -   te_misc_currency: acc=0.714 (5/7) avg_delta=-0.26 avg_delta_dyn=-1.04 avg_mag=2.17
2025-11-11 17:54:03,518Z - INFO -   te_stock_market_japan: acc=0.667 (2/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=4.73
2025-11-11 17:54:03,518Z - INFO -   te_stock_market_united_states: acc=0.571 (4/7) avg_delta=-2.56 avg_delta_dyn=-3.69 avg_mag=2.70
2025-11-11 17:54:03,518Z - INFO -   te_misc_commodity: acc=0.514 (18/35) avg_delta=-1.04 avg_delta_dyn=+0.38 avg_mag=2.45
2025-11-11 17:54:03,518Z - INFO -   te_stock_market_canada: acc=0.500 (2/4) avg_delta=-2.23 avg_delta_dyn=-2.65 avg_mag=7.17
2025-11-11 17:54:03,519Z - INFO -   te_stocks_united_kingdom: acc=0.500 (2/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 17:54:03,519Z - INFO -   te_stock_market_italy: acc=0.500 (2/4) avg_delta=-2.42 avg_delta_dyn=+0.28 avg_mag=4.03
2025-11-11 17:54:03,519Z - INFO -   te_stock_market_united_kingdom: acc=0.400 (2/5) avg_delta=+0.10 avg_delta_dyn=+3.48 avg_mag=1.10
2025-11-11 17:54:03,519Z - INFO -   te_stock_market_india: acc=0.000 (0/3) avg_delta=+1.53 avg_delta_dyn=+2.70 avg_mag=1.87
2025-11-11 17:54:03,519Z - INFO - 
=== FX-only performance (event types, top 10) ===
2025-11-11 17:54:03,524Z - INFO -   te_misc_currency: acc=0.714 (5/7) avg_delta=-0.26
2025-11-11 17:54:03,524Z - INFO -   te_misc_commodity: acc=0.514 (18/35) avg_delta=-1.04
2025-11-11 17:54:03,670Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 17:54:05,827Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 17:54:06,324Z - INFO - RMSE magnitude (pips) @+15m: 2.7234
2025-11-11 17:54:06,335Z - INFO - ==== TE V5 Trainer done ====
