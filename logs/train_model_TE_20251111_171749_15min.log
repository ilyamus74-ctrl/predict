2025-11-11 19:17:49,914Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 19:17:49,914Z - INFO - Connecting DB...
2025-11-11 19:17:49,971Z - INFO - DB OK
2025-11-11 19:17:49,971Z - INFO - Loading prices...
2025-11-11 19:19:34,300Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 19:19:37,644Z - INFO - Daily trends (SMA/trend)...
2025-11-11 19:19:39,122Z - INFO - Loading TE news...
2025-11-11 19:19:39,498Z - INFO - Excluded 678 stock-related events with prefixes ('te_stock_market_', 'te_stocks_')
2025-11-11 19:19:39,537Z - INFO - Filtered news piles >20: 9015 removed
2025-11-11 19:19:39,537Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 19:19:39,554Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 19:19:41,492Z - INFO - Dynamic horizon filter: 1230 -> 794 events (removed 436 with horizon < 5m)
2025-11-11 19:19:41,966Z - INFO - Direction classification thresholds mode=linear coeff=0.60, quantile candidate=1.24: min=1.8, coeff=0.6, vol_q=1.24
2025-11-11 19:19:41,967Z - INFO - Threshold range: [1.80, 2.04] pips, median=1.80
2025-11-11 19:19:41,967Z - INFO - Building features...
2025-11-11 19:19:41,979Z - INFO - Loading correlation features...
2025-11-11 19:19:41,984Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 19:19:42,006Z - INFO - Applied currency/year correlation fallback.
2025-11-11 19:19:42,889Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 19:19:42,955Z - INFO - Blocked split purge removed 36 events between train/test blocks
2025-11-11 19:19:42,959Z - INFO - Blocked split freq=W-MON train_periods=['2025-09-30/2025-10-06', '2025-10-07/2025-10-13', '2025-10-14/2025-10-20', '2025-10-21/2025-10-27'] test_periods=['2025-11-04/2025-11-10', '2025-11-11/2025-11-17'] purge=['2025-10-28/2025-11-03']
2025-11-11 19:19:42,960Z - INFO - Overall class distribution after filtering: counts=[132, 346, 280] share=[0.1741, 0.4565, 0.3694]
2025-11-11 19:19:42,963Z - INFO - Time split @ 2025-11-04 00:00:00: train=58, test=700
2025-11-11 19:19:42,963Z - INFO - Class balance (train): Counter({np.int64(1): 31, np.int64(2): 16, np.int64(0): 11})
2025-11-11 19:19:42,963Z - INFO - Class share (train): [0.1897, 0.5345, 0.2759]
2025-11-11 19:19:42,963Z - INFO - Class balance (test): Counter({np.int64(1): 315, np.int64(2): 264, np.int64(0): 121})
2025-11-11 19:19:42,963Z - INFO - Class share (test): [0.1729, 0.45, 0.3771]
2025-11-11 19:19:42,964Z - INFO - Baseline (majority=1) acc=0.4500
2025-11-11 19:19:42,964Z - INFO - Train RandomForest (direction)...
2025-11-11 19:19:44,230Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 19:19:46,826Z - INFO - Best XGB params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 19:19:47,071Z - INFO - Pred counts (raw): [271, 244, 185]
2025-11-11 19:19:47,071Z - INFO - Avg probs (raw p0,p1,p2): [0.3688, 0.3609, 0.2704]
2025-11-11 19:19:47,071Z - INFO - Train priors: [0.1897, 0.5345, 0.2759], alpha disabled
2025-11-11 19:19:47,072Z - INFO - Avg probs (raw p0,p1,p2): [0.3688, 0.3609, 0.2704]
2025-11-11 19:19:47,072Z - INFO - Pred counts (adj+margin): [219, 244, 237]
2025-11-11 19:19:47,074Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 41  40  40]
 [111 124  80]
 [ 67  80 117]]
2025-11-11 19:19:47,082Z - INFO - 
              precision    recall  f1-score   support

           0      0.187     0.339     0.241       121
           1      0.508     0.394     0.444       315
           2      0.494     0.443     0.467       264

    accuracy                          0.403       700
   macro avg      0.396     0.392     0.384       700
weighted avg      0.447     0.403     0.417       700

2025-11-11 19:19:47,085Z - INFO - Per-class recall: [0.339, 0.394, 0.443]
2025-11-11 19:19:47,085Z - INFO - Ensemble (RF+XGB) direction: acc=0.4029 f1=0.3840
2025-11-11 19:19:47,087Z - INFO - FX-only subset: n=700 share=100.00% acc=0.4029 macroF1=0.3840
