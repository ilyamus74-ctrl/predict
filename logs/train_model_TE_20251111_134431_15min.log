2025-11-11 15:44:31,813Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 15:44:31,813Z - INFO - Connecting DB...
2025-11-11 15:44:31,869Z - INFO - DB OK
2025-11-11 15:44:31,869Z - INFO - Loading prices...
2025-11-11 15:46:31,022Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 15:46:35,222Z - INFO - Daily trends (SMA/trend)...
2025-11-11 15:46:36,855Z - INFO - Loading TE news...
2025-11-11 15:46:37,521Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 15:46:37,521Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 15:46:37,544Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 15:46:39,530Z - INFO - Dynamic horizon filter: 1447 -> 991 events (removed 456 with horizon < 5m)
2025-11-11 15:46:40,016Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 15:46:40,016Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 15:46:40,017Z - INFO - Building features...
2025-11-11 15:46:40,031Z - INFO - Loading correlation features...
2025-11-11 15:46:40,036Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 15:46:40,062Z - INFO - Applied currency/year correlation fallback.
2025-11-11 15:46:40,969Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 15:46:41,062Z - INFO - Time split @ 2025-11-10 08:15:14+00:00: train=792, test=199
2025-11-11 15:46:41,063Z - INFO - Class balance (train): Counter({np.int64(2): 353, np.int64(1): 276, np.int64(0): 163})
2025-11-11 15:46:41,063Z - INFO - Class balance (test): Counter({np.int64(1): 73, np.int64(0): 73, np.int64(2): 53})
2025-11-11 15:46:41,064Z - INFO - Baseline (majority=2) acc=0.2663
2025-11-11 15:46:41,064Z - INFO - Train RandomForest (direction)...
2025-11-11 15:46:42,105Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 15:49:06,213Z - INFO - Best XGB params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 300}
2025-11-11 15:49:06,376Z - INFO - Pred counts (raw): [75, 117, 7]
2025-11-11 15:49:06,377Z - INFO - Avg probs (raw p0,p1,p2): [0.3446, 0.5497, 0.1057]
2025-11-11 15:49:06,377Z - INFO - Train priors: [0.2058, 0.3485, 0.4457], alpha: [1.128, 0.989, 0.93]
2025-11-11 15:49:06,378Z - INFO - Avg probs (calibrated p0,p1,p2): [0.3722, 0.5242, 0.1036]
2025-11-11 15:49:06,378Z - INFO - Pred counts (adj+margin): [80, 110, 9]
2025-11-11 15:49:06,384Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[37 33  3]
 [19 50  4]
 [24 27  2]]
2025-11-11 15:49:06,393Z - INFO - 
              precision    recall  f1-score   support

           0      0.463     0.507     0.484        73
           1      0.455     0.685     0.546        73
           2      0.222     0.038     0.065        53

    accuracy                          0.447       199
   macro avg      0.380     0.410     0.365       199
weighted avg      0.396     0.447     0.395       199

2025-11-11 15:49:06,396Z - INFO - Ensemble (RF+XGB) direction: acc=0.4472 f1=0.3649
2025-11-11 15:49:06,396Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 15:49:06,399Z - INFO - Conf>=0.50: coverage=82.91% n=165 acc=0.479 f1=0.365
2025-11-11 15:49:06,402Z - INFO - Conf>=0.55: coverage=68.34% n=136 acc=0.500 f1=0.376
2025-11-11 15:49:06,404Z - INFO - Conf>=0.60: coverage=50.75% n=101 acc=0.564 f1=0.412
2025-11-11 15:49:06,407Z - INFO - Conf>=0.65: coverage=33.67% n= 67 acc=0.642 f1=0.431
2025-11-11 15:49:06,410Z - INFO - Conf>=0.70: coverage=19.60% n= 39 acc=0.744 f1=0.284
2025-11-11 15:49:06,412Z - INFO - Conf>=0.75: coverage=14.07% n= 28 acc=0.786 f1=0.293
2025-11-11 15:49:06,413Z - INFO - 
=== Trade gate: conf>=0.65 + class-specific cutoffs ===
2025-11-11 15:49:06,415Z - INFO - Trade gate coverage=33.67% n= 67 acc=0.642 f1=0.431
2025-11-11 15:49:06,415Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 15:49:06,427Z - INFO - 
Top 10 best performing events:
2025-11-11 15:49:06,427Z - INFO -   te_stock_market_germany: acc=1.000 (3/3) avg_delta=+0.77 avg_delta_dyn=+8.83 avg_mag=4.03
2025-11-11 15:49:06,428Z - INFO -   te_stock_market_france: acc=1.000 (5/5) avg_delta=+0.32 avg_delta_dyn=+4.30 avg_mag=2.56
2025-11-11 15:49:06,428Z - INFO -   te_stock_market_japan: acc=1.000 (3/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=4.73
2025-11-11 15:49:06,428Z - INFO -   te_misc_currency: acc=0.833 (5/6) avg_delta=-0.42 avg_delta_dyn=-0.33 avg_mag=2.65
2025-11-11 15:49:06,428Z - INFO -   te_stock_market_euro_area: acc=0.800 (4/5) avg_delta=-4.26 avg_delta_dyn=+5.06 avg_mag=4.26
2025-11-11 15:49:06,428Z - INFO -   te_stock_market_united_states: acc=0.800 (4/5) avg_delta=-1.26 avg_delta_dyn=-4.80 avg_mag=1.62
2025-11-11 15:49:06,429Z - INFO -   te_stock_market_hong_kong: acc=0.667 (2/3) avg_delta=-1.10 avg_delta_dyn=+2.03 avg_mag=1.10
2025-11-11 15:49:06,429Z - INFO -   te_stock_market_indonesia: acc=0.667 (2/3) avg_delta=-2.40 avg_delta_dyn=+4.03 avg_mag=2.40
2025-11-11 15:49:06,429Z - INFO -   te_stock_market_united_kingdom: acc=0.600 (3/5) avg_delta=-0.76 avg_delta_dyn=+3.72 avg_mag=1.80
2025-11-11 15:49:06,429Z - INFO -   te_stock_market_italy: acc=0.600 (3/5) avg_delta=-1.64 avg_delta_dyn=+1.80 avg_mag=2.92
2025-11-11 15:49:06,429Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 15:49:06,430Z - INFO -   te_misc_currency: acc=0.833 (5/6) avg_delta=-0.42 avg_delta_dyn=-0.33 avg_mag=2.65
2025-11-11 15:49:06,430Z - INFO -   te_stock_market_euro_area: acc=0.800 (4/5) avg_delta=-4.26 avg_delta_dyn=+5.06 avg_mag=4.26
2025-11-11 15:49:06,430Z - INFO -   te_stock_market_united_states: acc=0.800 (4/5) avg_delta=-1.26 avg_delta_dyn=-4.80 avg_mag=1.62
2025-11-11 15:49:06,430Z - INFO -   te_stock_market_hong_kong: acc=0.667 (2/3) avg_delta=-1.10 avg_delta_dyn=+2.03 avg_mag=1.10
2025-11-11 15:49:06,430Z - INFO -   te_stock_market_indonesia: acc=0.667 (2/3) avg_delta=-2.40 avg_delta_dyn=+4.03 avg_mag=2.40
2025-11-11 15:49:06,430Z - INFO -   te_stock_market_united_kingdom: acc=0.600 (3/5) avg_delta=-0.76 avg_delta_dyn=+3.72 avg_mag=1.80
2025-11-11 15:49:06,431Z - INFO -   te_stock_market_italy: acc=0.600 (3/5) avg_delta=-1.64 avg_delta_dyn=+1.80 avg_mag=2.92
2025-11-11 15:49:06,431Z - INFO -   te_misc_commodity: acc=0.531 (17/32) avg_delta=-0.94 avg_delta_dyn=+0.70 avg_mag=2.50
2025-11-11 15:49:06,431Z - INFO -   te_stocks_united_kingdom: acc=0.500 (2/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 15:49:06,431Z - INFO -   te_stock_market_india: acc=0.000 (0/3) avg_delta=+2.57 avg_delta_dyn=+3.57 avg_mag=2.90
2025-11-11 15:49:06,592Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 15:49:10,202Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 200}
2025-11-11 15:49:10,877Z - INFO - RMSE magnitude (pips) @+15m: 2.7085
2025-11-11 15:49:10,887Z - INFO - ==== TE V5 Trainer done ====
