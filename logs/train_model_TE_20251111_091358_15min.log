2025-11-11 11:13:58,648Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 11:13:58,648Z - INFO - Connecting DB...
2025-11-11 11:13:58,704Z - INFO - DB OK
2025-11-11 11:13:58,704Z - INFO - Loading prices...
2025-11-11 11:16:23,812Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 11:16:27,607Z - INFO - Daily trends (SMA/trend)...
2025-11-11 11:16:29,361Z - INFO - Loading TE news...
2025-11-11 11:16:35,774Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 11:16:35,775Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 11:16:36,335Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 11:16:38,455Z - INFO - Dynamic horizon filter: 1427 -> 971 events (removed 456 with horizon < 5m)
2025-11-11 11:16:38,965Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 11:16:38,965Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 11:16:38,965Z - INFO - Building features...
2025-11-11 11:16:38,977Z - INFO - Loading correlation features...
2025-11-11 11:16:39,121Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 11:16:39,148Z - INFO - Applied currency/year correlation fallback.
2025-11-11 11:16:40,106Z - WARNING - Dropping constant features: ['imp_year_trend', 'price_change', 'corr_direction', 'probability', 'observations']
2025-11-11 11:16:40,191Z - INFO - Oversampling: class counts before=[205, 344, 227], after=[344, 344, 344]
2025-11-11 11:16:40,191Z - INFO - Time split @ 2025-11-10 07:05:12+00:00: train=776, test=195
2025-11-11 11:16:40,192Z - INFO - Class balance (train): Counter({np.int64(1): 344, np.int64(2): 227, np.int64(0): 205})
2025-11-11 11:16:40,192Z - INFO - Class balance (test): Counter({np.int64(1): 83, np.int64(0): 65, np.int64(2): 47})
2025-11-11 11:16:40,192Z - INFO - Baseline (majority=1) acc=0.4256
2025-11-11 11:16:40,193Z - INFO - Train RandomForest (direction)...
2025-11-11 11:16:41,805Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 11:20:09,048Z - INFO - Best XGB params: {'colsample_bytree': 0.7, 'learning_rate': 0.05, 'max_depth': 6, 'n_estimators': 400, 'subsample': 1.0}
2025-11-11 11:20:12,401Z - INFO - Train priors: [0.2642, 0.4433, 0.2925], alpha: [1.11, 0.88, 1.061]
2025-11-11 11:20:12,401Z - INFO - Pred counts (raw): [14, 172, 9]
2025-11-11 11:20:12,402Z - INFO - Avg probs (raw p0,p1,p2): [0.1643, 0.6933, 0.1423]
2025-11-11 11:20:12,402Z - INFO - Pred counts (adj): [18, 163, 14]
2025-11-11 11:20:12,402Z - INFO - Avg probs (adj p0,p1,p2): [0.1883, 0.655, 0.1567]
2025-11-11 11:20:12,403Z - INFO - Train priors: [0.2642, 0.4433, 0.2925], alpha: [1.11, 0.88, 1.061]
2025-11-11 11:20:12,403Z - INFO - Pred counts (0,1,2) adj: [14, 173, 8]
2025-11-11 11:20:12,403Z - INFO - Avg probs adj (p0,p1,p2): [0.1883, 0.655, 0.1567]
2025-11-11 11:20:12,403Z - INFO - Pred counts (0,1,2): [14, 173, 8]
2025-11-11 11:20:12,404Z - INFO - Avg probs (p0,p1,p2): [np.float64(0.1643), np.float64(0.6933), np.float64(0.1423)]
2025-11-11 11:20:12,407Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[ 3 54  8]
 [ 3 80  0]
 [ 8 39  0]]
2025-11-11 11:20:12,417Z - INFO - 
              precision    recall  f1-score   support

           0      0.214     0.046     0.076        65
           1      0.462     0.964     0.625        83
           2      0.000     0.000     0.000        47

    accuracy                          0.426       195
   macro avg      0.226     0.337     0.234       195
weighted avg      0.268     0.426     0.291       195

2025-11-11 11:20:12,421Z - INFO - Ensemble (RF+XGB) direction: acc=0.4256 f1=0.2336
2025-11-11 11:20:12,421Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 11:20:12,424Z - INFO - Conf>=0.50: coverage=77.44% n=151 acc=0.510 f1=0.244
2025-11-11 11:20:12,427Z - INFO - Conf>=0.55: coverage=69.74% n=136 acc=0.551 f1=0.240
2025-11-11 11:20:12,431Z - INFO - Conf>=0.60: coverage=59.49% n=116 acc=0.586 f1=0.246
2025-11-11 11:20:12,433Z - INFO - Conf>=0.65: coverage=50.77% n= 99 acc=0.576 f1=0.244
2025-11-11 11:20:12,436Z - INFO - Conf>=0.70: coverage=44.62% n= 87 acc=0.586 f1=0.246
2025-11-11 11:20:12,439Z - INFO - Conf>=0.75: coverage=34.87% n= 68 acc=0.632 f1=0.258
2025-11-11 11:20:12,442Z - INFO - Class-thresholds {0: 0.55, 1: 0.62, 2: 0.55}: coverage=57.95% n=113 acc=0.558 f1=0.243
2025-11-11 11:20:12,445Z - INFO - Class-thresholds {0: 0.6, 1: 0.64, 2: 0.58}: coverage=52.82% n=103 acc=0.583 f1=0.245
2025-11-11 11:20:12,445Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 11:20:12,457Z - INFO - 
Top 10 best performing events:
2025-11-11 11:20:12,458Z - INFO -   te_stock_market_china: acc=0.750 (3/4) avg_delta=+0.68 avg_mag=1.07
2025-11-11 11:20:12,458Z - INFO -   te_stock_market_hong_kong: acc=0.667 (2/3) avg_delta=-2.50 avg_mag=2.50
2025-11-11 11:20:12,458Z - INFO -   te_misc_commodity: acc=0.500 (16/32) avg_delta=-0.96 avg_mag=2.25
2025-11-11 11:20:12,458Z - INFO -   te_stock_market_euro_area: acc=0.500 (2/4) avg_delta=-4.62 avg_mag=4.62
2025-11-11 11:20:12,458Z - INFO -   te_misc_currency: acc=0.500 (3/6) avg_delta=+0.57 avg_mag=2.00
2025-11-11 11:20:12,459Z - INFO -   te_stock_market_france: acc=0.400 (2/5) avg_delta=+1.46 avg_mag=1.74
2025-11-11 11:20:12,459Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-2.73 avg_mag=2.73
2025-11-11 11:20:12,459Z - INFO -   te_stocks_united_kingdom: acc=0.333 (1/3) avg_delta=-1.83 avg_mag=1.83
2025-11-11 11:20:12,459Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+0.82 avg_mag=2.77
2025-11-11 11:20:12,459Z - INFO -   te_stock_market_united_states: acc=0.250 (1/4) avg_delta=-1.80 avg_mag=1.80
2025-11-11 11:20:12,459Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 11:20:12,460Z - INFO -   te_stock_market_euro_area: acc=0.500 (2/4) avg_delta=-4.62 avg_mag=4.62
2025-11-11 11:20:12,460Z - INFO -   te_misc_currency: acc=0.500 (3/6) avg_delta=+0.57 avg_mag=2.00
2025-11-11 11:20:12,460Z - INFO -   te_stock_market_france: acc=0.400 (2/5) avg_delta=+1.46 avg_mag=1.74
2025-11-11 11:20:12,460Z - INFO -   te_stock_market_indonesia: acc=0.333 (1/3) avg_delta=-2.73 avg_mag=2.73
2025-11-11 11:20:12,461Z - INFO -   te_stocks_united_kingdom: acc=0.333 (1/3) avg_delta=-1.83 avg_mag=1.83
2025-11-11 11:20:12,461Z - INFO -   te_stock_market_germany: acc=0.250 (1/4) avg_delta=+0.82 avg_mag=2.77
2025-11-11 11:20:12,461Z - INFO -   te_stock_market_united_states: acc=0.250 (1/4) avg_delta=-1.80 avg_mag=1.80
2025-11-11 11:20:12,461Z - INFO -   te_stock_market_italy: acc=0.200 (1/5) avg_delta=-1.12 avg_mag=2.40
2025-11-11 11:20:12,461Z - INFO -   te_stock_market_united_kingdom: acc=0.167 (1/6) avg_delta=-0.38 avg_mag=1.25
2025-11-11 11:20:12,461Z - INFO -   te_stock_market_japan: acc=0.000 (0/3) avg_delta=-4.73 avg_mag=4.73
2025-11-11 11:20:12,718Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 11:20:19,351Z - INFO - Best XGBReg params: {'learning_rate': 0.05, 'max_depth': 4, 'n_estimators': 400}
2025-11-11 11:20:19,369Z - INFO - RMSE magnitude (pips) @+15m: 4.6341
2025-11-11 11:20:19,423Z - INFO - ==== TE V5 Trainer done ====
