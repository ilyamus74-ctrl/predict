2025-11-11 15:30:35,492Z - INFO - ==== TE V5 Trainer start ====
2025-11-11 15:30:35,492Z - INFO - Connecting DB...
2025-11-11 15:30:35,552Z - INFO - DB OK
2025-11-11 15:30:35,552Z - INFO - Loading prices...
2025-11-11 15:32:32,279Z - INFO - Indicators (RSI/SMA/ATR)...
2025-11-11 15:32:35,791Z - INFO - Daily trends (SMA/trend)...
2025-11-11 15:32:37,358Z - INFO - Loading TE news...
2025-11-11 15:32:38,047Z - INFO - Filtered news piles >20: 9449 removed
2025-11-11 15:32:38,047Z - INFO - Loading imp_cache_tradingeconomics...
2025-11-11 15:32:38,066Z - INFO - Building targets (direction/magnitude) with +15m horizon...
2025-11-11 15:32:40,095Z - INFO - Dynamic horizon filter: 1443 -> 986 events (removed 457 with horizon < 5m)
2025-11-11 15:32:40,615Z - INFO - Direction classification thresholds: min=1.2, coeff=0.4
2025-11-11 15:32:40,615Z - INFO - Threshold range: [1.20, 1.36] pips, median=1.20
2025-11-11 15:32:40,616Z - INFO - Building features...
2025-11-11 15:32:40,632Z - INFO - Loading correlation features...
2025-11-11 15:32:40,639Z - INFO - Falling back to correlation_trends (currency/year).
2025-11-11 15:32:40,672Z - INFO - Applied currency/year correlation fallback.
2025-11-11 15:32:41,567Z - INFO - Labels: use_dynamic=False, y_col=direction_cls, mag_col=magnitude_pips
2025-11-11 15:32:41,574Z - WARNING - Dropping constant features: ['imp_year_trend', 'price_change', 'corr_direction', 'probability', 'observations']
2025-11-11 15:32:41,668Z - INFO - Time split @ 2025-11-10 07:54:13+00:00: train=788, test=198
2025-11-11 15:32:41,669Z - INFO - Class balance (train): Counter({np.int64(2): 353, np.int64(1): 272, np.int64(0): 163})
2025-11-11 15:32:41,669Z - INFO - Class balance (test): Counter({np.int64(0): 74, np.int64(1): 66, np.int64(2): 58})
2025-11-11 15:32:41,670Z - INFO - Baseline (majority=2) acc=0.2929
2025-11-11 15:32:41,670Z - INFO - Train RandomForest (direction)...
2025-11-11 15:32:42,816Z - INFO - GridSearch XGBClassifier (direction)...
2025-11-11 15:34:16,897Z - INFO - Best XGB params: {'learning_rate': 0.1, 'max_depth': 4, 'n_estimators': 300}
2025-11-11 15:34:17,044Z - INFO - Pred counts (raw): [74, 124, 0]
2025-11-11 15:34:17,044Z - INFO - Avg probs (raw p0,p1,p2): [0.3444, 0.6089, 0.0468]
2025-11-11 15:34:17,044Z - INFO - Pred counts (adj+margin): [74, 124, 0]
2025-11-11 15:34:17,047Z - INFO - 
Confusion matrix [rows=true (0,1,2), cols=pred]:
[[40 34  0]
 [13 53  0]
 [21 37  0]]
2025-11-11 15:34:17,057Z - INFO - 
              precision    recall  f1-score   support

           0      0.541     0.541     0.541        74
           1      0.427     0.803     0.558        66
           2      0.000     0.000     0.000        58

    accuracy                          0.470       198
   macro avg      0.323     0.448     0.366       198
weighted avg      0.344     0.470     0.388       198

2025-11-11 15:34:17,060Z - INFO - Ensemble (RF+XGB) direction: acc=0.4697 f1=0.3661
2025-11-11 15:34:17,060Z - INFO - 
=== Confidence-based filtering ===
2025-11-11 15:34:17,063Z - INFO - Conf>=0.50: coverage=90.91% n=180 acc=0.467 f1=0.365
2025-11-11 15:34:17,065Z - INFO - Conf>=0.55: coverage=75.25% n=149 acc=0.470 f1=0.364
2025-11-11 15:34:17,068Z - INFO - Conf>=0.60: coverage=62.12% n=123 acc=0.488 f1=0.360
2025-11-11 15:34:17,070Z - INFO - Conf>=0.65: coverage=43.43% n= 86 acc=0.500 f1=0.222
2025-11-11 15:34:17,073Z - INFO - Conf>=0.70: coverage=35.86% n= 71 acc=0.479 f1=0.216
2025-11-11 15:34:17,075Z - INFO - Conf>=0.75: coverage=31.31% n= 62 acc=0.548 f1=0.236
2025-11-11 15:34:17,076Z - INFO - 
=== Trade gate: conf>=0.65 + class-specific cutoffs ===
2025-11-11 15:34:17,078Z - INFO - Trade gate coverage=43.43% n= 86 acc=0.500 f1=0.222
2025-11-11 15:34:17,079Z - INFO - 
=== Performance by event type (top 10) ===
2025-11-11 15:34:17,094Z - INFO - 
Top 10 best performing events:
2025-11-11 15:34:17,095Z - INFO -   te_stock_market_euro_area: acc=1.000 (5/5) avg_delta=-4.18 avg_delta_dyn=+2.72 avg_mag=4.18
2025-11-11 15:34:17,096Z - INFO -   te_stock_market_japan: acc=1.000 (3/3) avg_delta=-4.73 avg_delta_dyn=+1.40 avg_mag=4.73
2025-11-11 15:34:17,096Z - INFO -   te_stock_market_hong_kong: acc=1.000 (3/3) avg_delta=-2.30 avg_delta_dyn=+0.53 avg_mag=2.30
2025-11-11 15:34:17,096Z - INFO -   te_stock_market_united_states: acc=0.800 (4/5) avg_delta=-1.16 avg_delta_dyn=-4.00 avg_mag=1.72
2025-11-11 15:34:17,096Z - INFO -   te_stock_market_germany: acc=0.750 (3/4) avg_delta=+0.68 avg_delta_dyn=+4.95 avg_mag=2.92
2025-11-11 15:34:17,097Z - INFO -   te_stocks_united_kingdom: acc=0.750 (3/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 15:34:17,097Z - INFO -   te_stock_market_italy: acc=0.750 (3/4) avg_delta=-1.27 avg_delta_dyn=+1.48 avg_mag=2.88
2025-11-11 15:34:17,097Z - INFO -   te_stock_market_indonesia: acc=0.667 (2/3) avg_delta=-2.27 avg_delta_dyn=+1.80 avg_mag=2.27
2025-11-11 15:34:17,097Z - INFO -   te_stock_market_france: acc=0.600 (3/5) avg_delta=+1.74 avg_delta_dyn=+4.36 avg_mag=2.02
2025-11-11 15:34:17,098Z - INFO -   te_stock_market_united_kingdom: acc=0.600 (3/5) avg_delta=-0.68 avg_delta_dyn=+2.38 avg_mag=1.72
2025-11-11 15:34:17,098Z - INFO - 
Bottom 10 worst performing events:
2025-11-11 15:34:17,098Z - INFO -   te_stock_market_united_states: acc=0.800 (4/5) avg_delta=-1.16 avg_delta_dyn=-4.00 avg_mag=1.72
2025-11-11 15:34:17,098Z - INFO -   te_stock_market_germany: acc=0.750 (3/4) avg_delta=+0.68 avg_delta_dyn=+4.95 avg_mag=2.92
2025-11-11 15:34:17,098Z - INFO -   te_stocks_united_kingdom: acc=0.750 (3/4) avg_delta=+0.05 avg_delta_dyn=-1.70 avg_mag=2.80
2025-11-11 15:34:17,099Z - INFO -   te_stock_market_italy: acc=0.750 (3/4) avg_delta=-1.27 avg_delta_dyn=+1.48 avg_mag=2.88
2025-11-11 15:34:17,099Z - INFO -   te_stock_market_indonesia: acc=0.667 (2/3) avg_delta=-2.27 avg_delta_dyn=+1.80 avg_mag=2.27
2025-11-11 15:34:17,099Z - INFO -   te_stock_market_france: acc=0.600 (3/5) avg_delta=+1.74 avg_delta_dyn=+4.36 avg_mag=2.02
2025-11-11 15:34:17,099Z - INFO -   te_stock_market_united_kingdom: acc=0.600 (3/5) avg_delta=-0.68 avg_delta_dyn=+2.38 avg_mag=1.72
2025-11-11 15:34:17,099Z - INFO -   te_misc_commodity: acc=0.559 (19/34) avg_delta=-0.94 avg_delta_dyn=+0.69 avg_mag=2.46
2025-11-11 15:34:17,100Z - INFO -   te_misc_currency: acc=0.500 (3/6) avg_delta=+0.77 avg_delta_dyn=-0.28 avg_mag=2.20
2025-11-11 15:34:17,100Z - INFO -   te_stock_market_india: acc=0.000 (0/3) avg_delta=+2.57 avg_delta_dyn=+3.57 avg_mag=2.90
2025-11-11 15:34:17,256Z - INFO - GridSearch XGBRegressor (magnitude)...
2025-11-11 15:34:19,396Z - INFO - Best XGBReg params: {'learning_rate': 0.1, 'max_depth': 6, 'n_estimators': 200}
2025-11-11 15:34:19,990Z - INFO - RMSE magnitude (pips) @+15m: 2.9903
2025-11-11 15:34:20,003Z - INFO - ==== TE V5 Trainer done ====
